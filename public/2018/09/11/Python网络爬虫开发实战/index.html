<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: true,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Python网络爬虫开发实战一、开发环境配置1.1 Python3 相关链接 官方网站：https://www.python.org 下载地址：https://www.python.org/downloads 第三方库：https://pypi.org 官方文档：https://docs.python.org/3 中文文档 中文教程： 菜鸟教程 廖雪峰Python3教程      1.2 请求库的">
<meta name="keywords" content="Python,Spider">
<meta property="og:type" content="article">
<meta property="og:title" content="Python网络爬虫开发实战">
<meta property="og:url" content="http://entercoder.com/2018/09/11/Python网络爬虫开发实战/index.html">
<meta property="og:site_name" content="EnterCoder&#39;s Blog">
<meta property="og:description" content="Python网络爬虫开发实战一、开发环境配置1.1 Python3 相关链接 官方网站：https://www.python.org 下载地址：https://www.python.org/downloads 第三方库：https://pypi.org 官方文档：https://docs.python.org/3 中文文档 中文教程： 菜鸟教程 廖雪峰Python3教程      1.2 请求库的">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNc79gy1ft42wp69kxj308704c74c.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNc79ly1ft4s5tla9lj30c204o3yt.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNc79ly1ft4s9daqiqj31hb0budj9.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tKfTcgy1ft6aro73clj30is0o4wix.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tKfTcgy1ft6arvf6lcj30in03q74u.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tKfTcly1ftnbc6u3r1j30di078mxt.jpg">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/006tKfTcly1ftnbdr0yg5j30au078aaf.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tKfTcly1ftnbi5yxaaj30le04c0tf.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tKfTcly1ftnbc6u3r1j30di078mxt.jpg">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/006tKfTcly1ftnbdr0yg5j30au078aaf.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tKfTcly1ftnbi5yxaaj30le04c0tf.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tKfTcly1ftnbjot2cdj30ld0n80y2.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tKfTcly1ftnblw5mb1j30lq02wgm4.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tNc79ly1fteyfoplygj30ml06ngmq.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNc79ly1fteyjn2frlj30ml06eq4b.jpg">
<meta property="og:image" content="http://entercoder.com/var/folders/g_/cckjvp_d1b39h60g3s9grbp00000gn/T/abnerworks.Typora/image.tiff">
<meta property="og:image" content="http://entercoder.com/var/folders/g_/cckjvp_d1b39h60g3s9grbp00000gn/T/abnerworks.Typora/image-20180810214920108.tiff">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/0069RVTdgy1fu4y2uiikhj31kw0v5174.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tNbRwgy1fvm5on4s0lj311h0opqv5.jpg">
<meta property="og:updated_time" content="2018-09-28T15:55:54.354Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python网络爬虫开发实战">
<meta name="twitter:description" content="Python网络爬虫开发实战一、开发环境配置1.1 Python3 相关链接 官方网站：https://www.python.org 下载地址：https://www.python.org/downloads 第三方库：https://pypi.org 官方文档：https://docs.python.org/3 中文文档 中文教程： 菜鸟教程 廖雪峰Python3教程      1.2 请求库的">
<meta name="twitter:image" content="https://ws2.sinaimg.cn/large/006tNc79gy1ft42wp69kxj308704c74c.jpg">






  <link rel="canonical" href="http://entercoder.com/2018/09/11/Python网络爬虫开发实战/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Python网络爬虫开发实战 | EnterCoder's Blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband">
      <a href="https://github.com/entercoder1993"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>

    </div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">EnterCoder's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">Enjoy Coding & Life</h1>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-image">
    <a href="/image/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-image"></i> <br />相册</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-美食记">
    <a href="/美食记/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-delicious"></i> <br />美食记</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-工具资源">
    <a href="/工具资源/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-wrench"></i> <br />工具资源</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://entercoder.com/2018/09/11/Python网络爬虫开发实战/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="entercoder1993">
      <meta itemprop="description" content="just coding">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="EnterCoder's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Python网络爬虫开发实战
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-11 22:24:32" itemprop="dateCreated datePublished" datetime="2018-09-11T22:24:32+08:00">2018-09-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-09-28 23:55:54" itemprop="dateModified" datetime="2018-09-28T23:55:54+08:00">2018-09-28</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Note/" itemprop="url" rel="index"><span itemprop="name">Note</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/11/Python网络爬虫开发实战/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2018/09/11/Python网络爬虫开发实战/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">65k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">59 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Python网络爬虫开发实战"><a href="#Python网络爬虫开发实战" class="headerlink" title="Python网络爬虫开发实战"></a>Python网络爬虫开发实战</h1><h2 id="一、开发环境配置"><a href="#一、开发环境配置" class="headerlink" title="一、开发环境配置"></a>一、开发环境配置</h2><h3 id="1-1-Python3"><a href="#1-1-Python3" class="headerlink" title="1.1 Python3"></a>1.1 Python3</h3><ul>
<li>相关链接<ul>
<li>官方网站：<a href="https://www.python.org" target="_blank" rel="noopener">https://www.python.org</a></li>
<li>下载地址：<a href="https://www.python.org/downloads" target="_blank" rel="noopener">https://www.python.org/downloads</a></li>
<li>第三方库：<a href="https://pypi.org" target="_blank" rel="noopener">https://pypi.org</a></li>
<li>官方文档：<a href="https://docs.python.org/3" target="_blank" rel="noopener">https://docs.python.org/3</a> <a href="http://docspy3zh.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">中文文档</a></li>
<li>中文教程：<ul>
<li><a href="http://www.runoob.com/python3/python3-tutorial.html" target="_blank" rel="noopener">菜鸟教程</a></li>
<li><a href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000" target="_blank" rel="noopener">廖雪峰Python3教程</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="1-2-请求库的安装"><a href="#1-2-请求库的安装" class="headerlink" title="1.2 请求库的安装"></a>1.2 请求库的安装</h3><h4 id="Request的安装"><a href="#Request的安装" class="headerlink" title="Request的安装"></a>Request的安装</h4><ul>
<li>相关链接<ul>
<li>GitHub：<a href="https://github.com/requests/requests" target="_blank" rel="noopener">https://github.com/requests/requests</a></li>
<li>PyPI：<a href="https://pypi.org/project/requests/" target="_blank" rel="noopener">https://pypi.org/project/requests/</a></li>
<li>官方文档：<a href="http://docs.python-requests.org/en/master/" target="_blank" rel="noopener">http://docs.python-requests.org/en/master/</a></li>
<li>中文文档：<a href="http://cn.python-requests.org/zh_CN/latest/" target="_blank" rel="noopener">http://cn.python-requests.org/zh_CN/latest/</a></li>
</ul>
</li>
</ul>
<h4 id="Selenium的安装"><a href="#Selenium的安装" class="headerlink" title="Selenium的安装"></a>Selenium的安装</h4><ul>
<li>相关链接<ul>
<li>官方网站：<a href="https://www.seleniumhq.org/" target="_blank" rel="noopener">https://www.seleniumhq.org/</a></li>
<li>GitHub：<a href="https://github.com/SeleniumHQ/Selenium" target="_blank" rel="noopener">https://github.com/SeleniumHQ/Selenium</a></li>
<li>PyPI：<a href="https://pypi.org/project/selenium/" target="_blank" rel="noopener">https://pypi.org/project/selenium/</a></li>
<li>官方文档：<a href="http://selenium-python.readthedocs.io/" target="_blank" rel="noopener">http://selenium-python.readthedocs.io/</a></li>
<li>中文文档：<a href="http://selenium-python-zh.readthedocs.io" target="_blank" rel="noopener">http://selenium-python-zh.readthedocs.io</a></li>
</ul>
</li>
</ul>
<h4 id="ChromeDriver的安装"><a href="#ChromeDriver的安装" class="headerlink" title="ChromeDriver的安装"></a>ChromeDriver的安装</h4><ul>
<li>相关链接<ul>
<li>官方地址：<a href="http://chromedriver.chromium.org/" target="_blank" rel="noopener">http://chromedriver.chromium.org/</a></li>
<li>下载地址：<a href="https://chromedriver.storage.googleapis.com/index.html?path=2.40/（需根据Chrome的版本下载对应的ChromeDriver）" target="_blank" rel="noopener">https://chromedriver.storage.googleapis.com/index.html?path=2.40/（需根据Chrome的版本下载对应的ChromeDriver）</a></li>
</ul>
</li>
<li>环境变量配置：<ul>
<li>Windows：将chromedriver.exe文件拖到Python的Scripts目录下即可。</li>
<li>Linux和Mac下<ul>
<li>将文件移动到<code>/usr/bin</code>目录下<code>suod mv chromedriver /usr/bin</code></li>
<li>或者将ChromeDriver配置到<code>$PATH export PATH=&quot;$PATH:/usr/local/chromedriver&quot;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="GeckoDriver的安装"><a href="#GeckoDriver的安装" class="headerlink" title="GeckoDriver的安装"></a>GeckoDriver的安装</h4><ul>
<li>相关链接<ul>
<li>Github：<a href="https://github.com/mozilla/geckodriver" target="_blank" rel="noopener">https://github.com/mozilla/geckodriver</a></li>
<li>下载地址：<a href="https://github.com/mozilla/geckodriver/releases" target="_blank" rel="noopener">https://github.com/mozilla/geckodriver/releases</a></li>
</ul>
</li>
</ul>
<h4 id="PhantomJS的安装"><a href="#PhantomJS的安装" class="headerlink" title="PhantomJS的安装"></a>PhantomJS的安装</h4><ul>
<li>相关链接<ul>
<li>官方网站：<a href="http://phantomjs.org" target="_blank" rel="noopener">http://phantomjs.org</a></li>
<li>官方文档：<a href="http://phantomjs.org/quick-start.html" target="_blank" rel="noopener">http://phantomjs.org/quick-start.html</a></li>
<li>下载地址：<a href="http://phantomjs.org/download.html" target="_blank" rel="noopener">http://phantomjs.org/download.html</a></li>
<li>API接口说明：<a href="http://phantomjs.org/api/command-line.html" target="_blank" rel="noopener">http://phantomjs.org/api/command-line.html</a></li>
</ul>
</li>
</ul>
<h4 id="aiohttp的安装"><a href="#aiohttp的安装" class="headerlink" title="aiohttp的安装"></a>aiohttp的安装</h4><ul>
<li>相关链接<ul>
<li>官方文档：<a href="https://docs.aiohttp.org/en/stable/" target="_blank" rel="noopener">https://docs.aiohttp.org/en/stable/</a></li>
<li>GitHub：<a href="https://github.com/aio-libs/aiohttp" target="_blank" rel="noopener">https://github.com/aio-libs/aiohttp</a></li>
<li>PyPI：<a href="https://pypi.org/project/aiohttp/" target="_blank" rel="noopener">https://pypi.org/project/aiohttp/</a></li>
</ul>
</li>
</ul>
<h3 id="1-3-解析库的安装"><a href="#1-3-解析库的安装" class="headerlink" title="1.3 解析库的安装"></a>1.3 解析库的安装</h3><h4 id="lxml的安装"><a href="#lxml的安装" class="headerlink" title="lxml的安装"></a>lxml的安装</h4><ul>
<li>相关链接<ul>
<li>官方网站：<a href="https://lxml.de/" target="_blank" rel="noopener">https://lxml.de/</a></li>
<li>GitHub：<a href="https://github.com/lxml/lxml" target="_blank" rel="noopener">https://github.com/lxml/lxml</a></li>
<li>PyPI：<a href="https://pypi.org/project/lxml/" target="_blank" rel="noopener">https://pypi.org/project/lxml/</a></li>
</ul>
</li>
</ul>
<h4 id="Beautiful-Soup4的安装"><a href="#Beautiful-Soup4的安装" class="headerlink" title="Beautiful Soup4的安装"></a>Beautiful Soup4的安装</h4><ul>
<li>相关链接<ul>
<li>官方网站：<a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" target="_blank" rel="noopener">https://www.crummy.com/software/BeautifulSoup/bs4/doc/</a></li>
<li>中文文档：<a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh/" target="_blank" rel="noopener">https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh/</a></li>
<li>PyPI：<a href="https://pypi.org/project/beautifulsoup4/" target="_blank" rel="noopener">https://pypi.org/project/beautifulsoup4/</a></li>
</ul>
</li>
</ul>
<h4 id="pyquery的安装"><a href="#pyquery的安装" class="headerlink" title="pyquery的安装"></a>pyquery的安装</h4><ul>
<li>相关链接<ul>
<li>官方网站：<a href="https://pythonhosted.org/pyquery/" target="_blank" rel="noopener">https://pythonhosted.org/pyquery/</a></li>
<li>GitHub：<a href="https://github.com/gawel/pyquery/" target="_blank" rel="noopener">https://github.com/gawel/pyquery/</a></li>
<li>PyPI：<a href="https://pypi.org/project/pyquery/" target="_blank" rel="noopener">https://pypi.org/project/pyquery/</a></li>
</ul>
</li>
</ul>
<h4 id="tesserocr的安装"><a href="#tesserocr的安装" class="headerlink" title="tesserocr的安装"></a>tesserocr的安装</h4><ul>
<li>相关链接<ul>
<li>tesserocr GitHub：<a href="https://github.com/tesseract-ocr/tesseract" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tesseract</a></li>
<li>tesserocr PyPI：<a href="https://pypi.org/project/tesserocr/" target="_blank" rel="noopener">https://pypi.org/project/tesserocr/</a></li>
<li>tesseract 下载地址：<a href="https://github.com/tesseract-ocr/tesseract/wiki" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tesseract/wiki</a></li>
<li>tesseract GitHub：<a href="https://github.com/tesseract-ocr/tesseract" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tesseract</a></li>
<li>tesseract语言包：<a href="https://github.com/tesseract-ocr/tessdata" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tessdata</a></li>
<li>tesseract文档：<a href="https://github.com/tesseract-ocr/tesseract/wiki/Documentation" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tesseract/wiki/Documentation</a></li>
</ul>
</li>
</ul>
<h3 id="1-4-数据库的安装"><a href="#1-4-数据库的安装" class="headerlink" title="1.4 数据库的安装"></a>1.4 数据库的安装</h3><h4 id="MySQL的安装"><a href="#MySQL的安装" class="headerlink" title="MySQL的安装"></a>MySQL的安装</h4><h4 id="MongoDB的安装"><a href="#MongoDB的安装" class="headerlink" title="MongoDB的安装"></a>MongoDB的安装</h4><h4 id="Redis的安装"><a href="#Redis的安装" class="headerlink" title="Redis的安装"></a>Redis的安装</h4><h3 id="1-5-存储库的安装"><a href="#1-5-存储库的安装" class="headerlink" title="1.5 存储库的安装"></a>1.5 存储库的安装</h3><h4 id="PyMySQL的安装"><a href="#PyMySQL的安装" class="headerlink" title="PyMySQL的安装"></a>PyMySQL的安装</h4><h4 id="PyMongo的安装"><a href="#PyMongo的安装" class="headerlink" title="PyMongo的安装"></a>PyMongo的安装</h4><h4 id="redis-py的安装"><a href="#redis-py的安装" class="headerlink" title="redis-py的安装"></a>redis-py的安装</h4><h4 id="RedisDump的安装"><a href="#RedisDump的安装" class="headerlink" title="RedisDump的安装"></a>RedisDump的安装</h4><h3 id="1-6-Web库的安装"><a href="#1-6-Web库的安装" class="headerlink" title="1.6 Web库的安装"></a>1.6 Web库的安装</h3><h4 id="Flask的安装"><a href="#Flask的安装" class="headerlink" title="Flask的安装"></a>Flask的安装</h4><h4 id="Tornado的安装"><a href="#Tornado的安装" class="headerlink" title="Tornado的安装"></a>Tornado的安装</h4><h3 id="1-7-App爬取相关的库安装"><a href="#1-7-App爬取相关的库安装" class="headerlink" title="1.7 App爬取相关的库安装"></a>1.7 App爬取相关的库安装</h3><h4 id="Charles的安装"><a href="#Charles的安装" class="headerlink" title="Charles的安装"></a>Charles的安装</h4><h4 id="mitmproxy的安装"><a href="#mitmproxy的安装" class="headerlink" title="mitmproxy的安装"></a>mitmproxy的安装</h4><h3 id="1-8-爬虫框架的安装"><a href="#1-8-爬虫框架的安装" class="headerlink" title="1.8 爬虫框架的安装"></a>1.8 爬虫框架的安装</h3><h4 id="pyspider的安装"><a href="#pyspider的安装" class="headerlink" title="pyspider的安装"></a>pyspider的安装</h4><h4 id="Scrapy的安装"><a href="#Scrapy的安装" class="headerlink" title="Scrapy的安装"></a>Scrapy的安装</h4><h4 id="Scrapy-Splash的安装"><a href="#Scrapy-Splash的安装" class="headerlink" title="Scrapy-Splash的安装"></a>Scrapy-Splash的安装</h4><h4 id="Scrapy-Redis的安装"><a href="#Scrapy-Redis的安装" class="headerlink" title="Scrapy-Redis的安装"></a>Scrapy-Redis的安装</h4><h3 id="1-9-部署库相关的库的安装"><a href="#1-9-部署库相关的库的安装" class="headerlink" title="1.9 部署库相关的库的安装"></a>1.9 部署库相关的库的安装</h3><h4 id="Docker的安装"><a href="#Docker的安装" class="headerlink" title="Docker的安装"></a>Docker的安装</h4><ul>
<li><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$brew</span> cask install docker</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Scrapyd的安装"><a href="#Scrapyd的安装" class="headerlink" title="Scrapyd的安装"></a>Scrapyd的安装</h4><ul>
<li><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pip3</span> install scrapyd</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置</p>
<ul>
<li>新建配置文件/etc/scrapyd/scrapyd.conf</li>
</ul>
</li>
</ul>
<h4 id="Scrapyd的安装-1"><a href="#Scrapyd的安装-1" class="headerlink" title="Scrapyd的安装"></a>Scrapyd的安装</h4><h4 id="Scrapyd-Client的安装"><a href="#Scrapyd-Client的安装" class="headerlink" title="Scrapyd-Client的安装"></a>Scrapyd-Client的安装</h4><h4 id="Scrapyd-API的安装"><a href="#Scrapyd-API的安装" class="headerlink" title="Scrapyd API的安装"></a>Scrapyd API的安装</h4><h4 id="Scrapyrt的安装"><a href="#Scrapyrt的安装" class="headerlink" title="Scrapyrt的安装"></a>Scrapyrt的安装</h4><h4 id="Gerapy的安装"><a href="#Gerapy的安装" class="headerlink" title="Gerapy的安装"></a>Gerapy的安装</h4><h2 id="二、爬虫基础"><a href="#二、爬虫基础" class="headerlink" title="二、爬虫基础"></a>二、爬虫基础</h2><h3 id="2-1-HTTP基本原理"><a href="#2-1-HTTP基本原理" class="headerlink" title="2.1 HTTP基本原理"></a>2.1 HTTP基本原理</h3><blockquote>
<p><strong>请求</strong>网站并<strong>提取</strong>数据的<strong>自动化</strong>程序</p>
</blockquote>
<ul>
<li><p>URI和URL</p>
<ul>
<li><p>URI全称Uniform Resource Identifier，即统一资源标志符</p>
</li>
<li><p>URL全称Universal Resource Locator，即统一资源定位符</p>
</li>
<li><p>URL是URI的子集</p>
</li>
<li><p>另一个子类为URN全称Universal Resource Name，即统一资源名称</p>
</li>
<li><p>关系</p>
<p>  <img src="https://ws2.sinaimg.cn/large/006tNc79gy1ft42wp69kxj308704c74c.jpg" alt="img"></p>
</li>
</ul>
</li>
<li><p>超文本(hypertext)，网页就是超文本解析而成的。</p>
</li>
<li><p>HTTP和HTTPS</p>
<ul>
<li>HTTP全称Hyper Text Transfer Protocol，中文名称:超文本传输协议。是用于从网络传输文本数据到本地浏览器的传送协议，它能保证高效而准确地传送超文本文档。</li>
<li>HTTPS全称Hyper Text Transfer Protocol voer Secure  Socket Layer，是以安全为目标的HTTP通道，即HTTP的安全版，HTTP下加入SSL层，简称HTTPS<ul>
<li>作用:<ul>
<li>建立一个信息安全通道来保证数据传输的安全</li>
<li>确认网站的真实性，凡是使用了HTTPS的网站，都可以通过点击浏览地址栏的锁头标志来查看网站认证之后的真实信息，也可以通过CA机构颁发的安全签章来查询。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>HTTP请求过程</p>
<ol>
<li>浏览器向网站所在的服务器发送一个请求</li>
<li>网站服务器接受到这个请求后进行处理和解析</li>
<li>返回对应的响应（响应包含页面的源代码等内容）</li>
<li>传回给浏览器（浏览器对其进行解析，便将网页呈现出来）</li>
</ol>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1ft4s5tla9lj30c204o3yt.jpg" alt="img"></p>
<ol start="5">
<li><p>Chrome浏览器</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1ft4s9daqiqj31hb0budj9.jpg" alt="image-20180710151010965"></p>
<ul>
<li>Name：请求的名称，一般会将URL的最后一部分内容当做名称</li>
<li>Status：响应的状态码，200代表响应是正常的</li>
<li>Type：请求的文档类型</li>
<li>Initiator：请求源。用来标记请求是由哪个对象或进程发起的</li>
<li>Size：从服务器下载的文件和请求的资源大小。如果从缓存中取得的数据，则该列会像是from cache</li>
<li>Time：发起请求到获取响应所用的总时间</li>
<li>Waterfall：网络请求的可视化瀑布流</li>
</ul>
</li>
</ol>
</li>
<li><p>请求</p>
<ul>
<li><p>请求方法</p>
<ul>
<li>GET</li>
<li>POST</li>
<li>区别<ul>
<li>GET请求中的参数包含在URL里面，数据可以在URL中看到，而POST请求的URL不会包含这些数据，数据都是通过表单形式传输的，会包含在请求体中</li>
<li>GET请求提交的数据最多只有1024字节，而POST方式没有限制</li>
</ul>
</li>
<li>其他方法：<ul>
<li>GET、HEAD、POST、PUT、DELETE、OPTIONS、CONNECT、TRACE等</li>
</ul>
</li>
</ul>
<p>| 方法    | 描述                                                         |<br>| ——- | ———————————————————— |<br>| GET     | 请求页面，并返回页面内容                                     |<br>| HEAD    | 类似于GET请求，只不过返回的响应中没有具体的内容，用于获取报头 |<br>| POST    | 大多用于提交表单或上传文件，数据包含在请求体中               |<br>| PUT     | 从客户端向服务器传送的数据取代指定文档中的内容               |<br>| DELETE  | 请求服务器删除指定的页面                                     |<br>| CONNECT | 把服务器当做跳板，让服务器代替客户端访问其他网页             |<br>| OPTIONS | 允许客户端查看服务器的性能                                   |<br>| TRACE   | 回显服务器收到的请求，主要用于测试或诊断                     |</p>
</li>
<li><p>请求的网址：即统一资源定位符URL，它可以唯一确定我们想请求的资源</p>
</li>
<li><p>请求头</p>
<ul>
<li>Accept：请求报头域，用于指定客户端可接受哪些类型的信息</li>
<li>Accept-Language：制定客户端可接受的语言类型</li>
<li>Accept-Encoding：指定客户端可接受的内容编码</li>
<li>Host：用于请求资源的主机IP和端口号，其内容为请求URL的原始服务器或网关的位置</li>
<li>Cookie：常用复数形式Cookies，这是网站为了辨别用户进行会话跟踪而存储在用户本地的数据。主要功能是维持当前访问会话。</li>
<li>Referer：便是请求是从哪个页面发过来的，服务器可以拿到这一信息并做相应的处理，如做来源统计、防盗链处理等。</li>
<li>User-Agent：简称UA，它是一个特殊的字符串头，可以使服务器识别客户使用的操作系统及版本、浏览器及版本等信息。在做爬虫时加上此信息，可以伪装为浏览器；如果不加，很可能会被识别为爬虫。</li>
<li>Content-Type：也叫互联网媒体类型或者MIME类型，如HTTP协议消息头中，它用来表示具体请求中的媒体类型信息。text\html代表HTML格式，image/gif代表GIF图片，application/json代表JSON类型等。</li>
</ul>
</li>
<li><p>请求体：登录之前，填写的用户名和密码信息，提交时这些内容就会以表单数据的形式提交给服务器，只有有设置Request Headers中的Content-Type为application/x-www-form-urlencoded时，才会以表单数据的形式提交。</p>
<p>| Content-Type                      | 提交数据的方式 |<br>| ——————————— | ————– |<br>| application/x-www-form-urlencoded | 表单数据       |<br>| mulitipart/form-data              | 表单文件上传   |<br>| application/json                  | 序列化JSON数据 |<br>| text/xml                          | XML数据        |</p>
</li>
</ul>
</li>
<li><p>响应</p>
<ul>
<li><p>响应状态码（Response Status Code）</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ft6aro73clj30is0o4wix.jpg" alt="img"></p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ft6arvf6lcj30in03q74u.jpg" alt="img"></p>
</li>
<li><p>响应头（Response Headers）</p>
<ul>
<li>Date：标识响应产生的时间</li>
<li>Last-Moidfied：指定资源的最后修改时间</li>
<li>Content-Encoding：指定响应内容的编码</li>
<li>Server：包含服务器的信息，比如名称、版本号等</li>
<li>Content-Type：文档类型，指定返回的数据类型是什么就返回什么类型</li>
<li>Set-Cookie：设置Cookies。响应头中的Set-Cookie告诉浏览器需要将此内容放在Cooikes中，下次请求携带Cookies请求</li>
<li>Expires：指定响应的过期时间，可以使代理服务器或浏览器将加载的内容更新到缓存中。如再次访问时，就可以直接从缓存中加载。</li>
</ul>
</li>
<li><p>响应体（Response Body）：响应的正文数据都在响应体重，比如请求网页时，它的响应就是网页的HTML代码。爬虫请求网页后，要解析的内容就是响应体。</p>
</li>
</ul>
</li>
</ul>
<h3 id="2-2-网页基础"><a href="#2-2-网页基础" class="headerlink" title="2.2 网页基础"></a>2.2 网页基础</h3><ul>
<li><p>网页可以分成三大部分：HTML、CSS和JavaScript</p>
<ul>
<li>HTML（Hyper Text Markup Language，即超文本标记语言）：是用来描述网页的一种协议</li>
<li>CSS（Cascading Sytle Sheet，即层叠样式表）：“层叠”是指当在HTML中引用了数个样式文件，并且样式发生冲突时，浏览器能依据层叠顺序处理。“样式”指网页中文字大小、颜色、元素间距、排列等格式</li>
<li>JavaScript：简称JS，是一种脚本语言。HTML和CSS配合使用，提供给用户的只是一种静态信息，缺乏交互性。网页里的交互和动画效果，通常都是JavaScript的功劳。它的出现使得用户与信息之间不只是一种浏览与显示的关系，而是实现了一种实时、动态、交互的页面功能。</li>
</ul>
</li>
<li><p>网页的结构</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 定义文档类型 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- head标签内定义了一些页面的配置和引用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定网页编码为utf-8 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 网页的标题 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>This is a Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- div标签定义了网页中的区块，id是container，id的内容在网页中是唯一的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- class所谓wrapper --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">                    Hello World</span><br><span class="line">                <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    Hello,This iis a paragraph.</span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>节点树及节点间的关系：在HTML中，所有标签定义的内容都是节点，它们构成了HTML DOM树</p>
<blockquote>
<p>DOM(Document Object Model)文档对象模型。它定义了访问HTML和XML文档的标准</p>
</blockquote>
<ul>
<li><p>W3C DOM标准被分为3个不同的部分</p>
<ol>
<li>核心DOM：针对任何结构化文档的标准模型</li>
<li>XML DOM：针对XML文档的标准模型</li>
<li>HTML DOM：针对HTML文档的标准模型</li>
</ol>
</li>
<li><p>根据W3C的HTML DOM标准，HTML文档中的所有内容都是节点</p>
<ul>
<li>整个文档是一个文档节点</li>
<li>每个HTML元素是元素节点</li>
<li>HTML元素内的文本是文本节点</li>
<li>每个HTML属性都是属性节点</li>
<li>注释是注释节点</li>
</ul>
</li>
<li><p>节点树</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcly1ftnbc6u3r1j30di078mxt.jpg" alt="img"></p>
</li>
<li><p>节点树及节点之间的关系</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcly1ftnbdr0yg5j30au078aaf.jpg" alt="img"></p>
</li>
</ul>
</li>
<li><p>CSS选择器的语法规则</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1ftnbi5yxaaj30le04c0tf.jpg" alt="img"></p>
</li>
</ul>
<ul>
<li><p>节点树</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcly1ftnbc6u3r1j30di078mxt.jpg" alt="img"></p>
</li>
<li><p>节点树及节点之间的关系</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcly1ftnbdr0yg5j30au078aaf.jpg" alt="img"></p>
</li>
</ul>
<ul>
<li><p>CSS选择器的语法规则</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1ftnbi5yxaaj30le04c0tf.jpg" alt="img"></p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcly1ftnbjot2cdj30ld0n80y2.jpg" alt="img"></p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1ftnblw5mb1j30lq02wgm4.jpg" alt="img"></p>
</li>
</ul>
<h3 id="2-3-爬虫的基本原理"><a href="#2-3-爬虫的基本原理" class="headerlink" title="2.3 爬虫的基本原理"></a>2.3 爬虫的基本原理</h3><ul>
<li><p>爬虫概述：爬虫就是获取网页并提取和保存信息的自动化程序。</p>
<ol>
<li>获取网页：获取网页的源代码，并从源代码中提取想要的信息</li>
<li>提取信息：分析网页源代码，从中提取我们想要的数据。<ul>
<li>正则表达式提取，这是一个万能的方法，但是在构造时比较复杂且易出错。</li>
<li>根据网页节点属性、CSS选择器或XPath来提取网页信息的库：如Beautiful Soup、pyquery、lxml。</li>
</ul>
</li>
<li>保存数据：可以简单保存为文本或JSON文本，也可以保存到数据库，如MySQL和MongoDB等，也可以保存至远程服务器。</li>
<li>自动化程序：爬虫可以替代我们来完成爬取工作的自动化程序，他可以在爬取过程中进行各种异常处理、错误重试等操作，以确保爬取持续高效地运行。</li>
</ol>
</li>
<li><p>能抓怎样的数据：HTML源代码、二进制数据、JSON字符串等，只要在浏览器里面可以访问得到，就可以将其抓取下来。</p>
</li>
<li><p>JavaScript渲染页面</p>
<p>网页越来越多地采用Ajax、前端模块化工具来构建，整个网页可能都是由JavaScript渲染出来的，原始的HTML代码就是一个空壳。使用urlib或requests请求当前页面时，我们只能得到这个HTML代码，它不会帮助我们去继续加载这个JavaScript文件。</p>
<ul>
<li>解决方法<ul>
<li>分析Ajax接口</li>
<li>使用Selenium、Splash等库实现模拟JavaScript渲染</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-4-会话和Cookies"><a href="#2-4-会话和Cookies" class="headerlink" title="2.4 会话和Cookies"></a>2.4 会话和Cookies</h3><h4 id="无状态HTTP"><a href="#无状态HTTP" class="headerlink" title="无状态HTTP"></a>无状态HTTP</h4><p>HTTP协议对事务处理是没有记忆能力的，即服务器不知道客户端是什么状态。当我们向服务器发送请求后，服务器解析请求，然后返回对应的响应，服务器负责完成这个过程，该过程是完全独立的，服务器不会记录前后状态的变化，缺少状态记录。若后续需要处理前面的信息，则必须重传，这导致需要额外传递一些前面的重复请求，才能获取后续响应。</p>
<p>会话和Cookies可以保持HTTP连接的状态，会话在服务端，Cookies在客户端。浏览器在下次访问网页时会自动附带上Cookies发送给服务器，服务器通过识别Cookies并鉴定出是哪个用户，然后再判断用户是否是登录状态，然后返回对应的响应。</p>
<p>会话和Cookies可以保持HTTP连接的状态，会话在服务端，Cookies在客户端。浏览器在下次访问网页时会自动附带上Cookies发送给服务器，服务器通过识别Cookies并鉴定出是哪个用户，然后再判断用户是否是登录状态，然后返回对应的响应。</p>
<ul>
<li>会话：在Web中，会话对象用来存储特定用户会话所需的属性及配置信息。当用户在应用程序的Web也之间跳转存储在会话对象中的变量将不会丢失，而是在用户会话中一直存在下去。当用户请求来自应用程序的Web页时，如果该用户还没有会话，则Web服务器自动创建一个会话对象。当会话过期或被放弃后，服务器将终止该会话。</li>
<li>Cookies：Cookies指某些网站为了辨别用户身份、进行会话跟踪而存储在用户本地端上的数据。<ul>
<li>会话维持</li>
<li>属性结构<ul>
<li>Name：Cookies的名称，一旦创建不可更改</li>
<li>Value：该Cookies的值。如果值为Unicode字符，需要为字符编码。如果为二进制数据，则需要用BASE64编码</li>
<li>Domain：可以访问该Cookie的域名</li>
<li>Max Age：Cookie失效的时间，单位为秒，若为正数，则Cookie在Max Age秒之后失效。若为负数，关闭浏览器即失效。</li>
<li>Path：该Cookie的使用路径。若设置为/，则本域名下所有页面都可以访问该Cookie</li>
<li>Size：Cookie的大小</li>
<li>HTTP：Cookie的httponly属性。若为True，则只有在HTTP头中带有此Cookie的信息，而不能通过document.cookie来访问此Cookie</li>
<li>Secure：该Cookie是否仅被使用安全协议传输。安全协议有HTTPS和SSL等，在网络上传输数据之间先将数据加密。默认为false</li>
</ul>
</li>
</ul>
</li>
<li>常见误区<ul>
<li>除非程序通知服务器删除一个会话，否则服务器会一直保留。</li>
<li>关闭浏览器不会导致会话被删除，这就需要服务器为会话设置一个失效时间，当距离客户端上一次使用会话的时间超过这个失效时间时，服务器就可以认为客户端已停止活动，然后才会将会话删除。</li>
</ul>
</li>
</ul>
<h3 id="2-5-代理的基本原理"><a href="#2-5-代理的基本原理" class="headerlink" title="2.5 代理的基本原理"></a>2.5 代理的基本原理</h3><h4 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h4><p>代理实际上是指代理服务器，英文叫作proxy server，他的功能是代理网络用户去取得网络信息。形象地说，它是网络信息的中转站。如果设置了代理服务器，本机不是直接向Web服务器发起请求，而是向代理服务器发出请求，请求会发送给代理服务器，然后代理服务器再发送给Web服务器，接着由代理服务器再把Web服务器返回的响应转发给本机。<br>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p>
<ul>
<li><p>作用</p>
<ul>
<li>突破IP访问限制，访问一些平时不能访问的站点</li>
<li>访问一些单位或团体内部资源：比如使用教育网内地址段免费代理服务器，就可以对教育网开放的各类FTP下载上传，以及各类资料查询共享等服务</li>
<li>提高访问速度：通常代理服务器都设置一个较大的硬盘缓冲区，当有外接的信息通过时，同时也将其保存在缓冲区中，当其他用户再访问相同的信息时，则直接由缓冲区中取出信息，传给用户，以提高访问速度。</li>
<li>隐藏真实IP</li>
</ul>
</li>
<li><p>爬虫代理</p>
</li>
<li><p>作用</p>
<ul>
<li>突破IP访问限制，访问一些平时不能访问的站点</li>
<li>访问一些单位或团体内部资源：比如使用教育网内地址段免费代理服务器，就可以对教育网开放的各类FTP下载上传，以及各类资料查询共享等服务</li>
<li>提高访问速度：通常代理服务器都设置一个较大的硬盘缓冲区，当有外接的信息通过时，同时也将其保存在缓冲区中，当其他用户再访问相同的信息时，则直接由缓冲区中取出信息，传给用户，以提高访问速度。</li>
<li>隐藏真实IP</li>
</ul>
</li>
<li><p>爬虫代理</p>
<p>对于爬虫来说，由于爬虫爬取速度过快，在爬取过程中可能遇到同一个IP访问过于频繁的问题，此时网站就会让我们输入验证码登录后者直接封锁IP。</p>
<p>使用代理隐藏真实的IP，让服务器以为是代理服务器在请求自己。这样再爬取过程中通过不断更换代理，就不会被封锁。</p>
</li>
<li><p>代理分类</p>
<ul>
<li>根据协议<ul>
<li>FTP代理服务器：主要用于访问FTP服务器，一般有上传、下载及缓存功能，端口一般为21、2121等</li>
<li>HTTP代理服务器：主要用于访问网页，一般有内容过滤和缓存功能，端口一般为80、8080、3128</li>
<li>SSL/TLS代理：主要用于访问加密网站，一般有SSL或TLS加密功能（最高支持128位加密强度），端口一般为443</li>
<li>RTSP代理：主要用于访问Real流媒体服务器，一般有缓存功能，端口一般为554</li>
<li>Telnet代理：主要用于telnet远程控制（黑客入侵计算机时常用语隐藏身份），端口一般为23</li>
<li>POP3/SMTP代理：主要用户POP3/SMTP方式收发邮件，一般有缓存功能，端口一般为110/25</li>
<li>SOCKS代理：单纯传递数据包，速度快，一般有缓存功能，端口一般为1080<ul>
<li>SOCKS4：只支持TCP</li>
<li>SOCKS5：支持TCP和UDP，还支持各种身份验证机制、服务器域名解析等</li>
</ul>
</li>
</ul>
</li>
<li>根据匿名程度<ul>
<li>高度匿名代理：数据包原封不动地转发</li>
<li>普通匿名代理：会在数据包上做一些改动，服务端有可能发现这个是代理服务器，也有一定几率追查到真实IP。代理服务器通常会加入的HTTP头有HTTP_VIA和HTTP_X_FORWARDED_FOR</li>
<li>透明代理：不但改动数据包，还有告诉服务器客户端的真实IP。这种代理除了能用缓存技术提高浏览速度，能将内容过滤提高安全性之外，并无其他显著作用，最常见的例子是内网中的硬件防火墙</li>
<li>间谍代理：指组织或个人创建的用于记录用户传输的数据，然后进行研究、监控等目的的代理服务器</li>
</ul>
</li>
</ul>
</li>
<li><p>常见代理设置</p>
<ul>
<li>使用网上的免费代理</li>
<li>使用付费代理服务</li>
<li>ADSL拨号</li>
</ul>
</li>
</ul>
<h2 id="三、基本库的使用"><a href="#三、基本库的使用" class="headerlink" title="三、基本库的使用"></a>三、基本库的使用</h2><h3 id="3-1-使用urllib"><a href="#3-1-使用urllib" class="headerlink" title="3.1 使用urllib"></a>3.1 使用urllib</h3><blockquote>
<p><a href="https://docs.python.org/3/library/urllib.html" target="_blank" rel="noopener">官方文档</a></p>
</blockquote>
<ul>
<li><p>四个模块</p>
<ul>
<li>request：最基本的HTTP请求模块，用来模拟发送请求</li>
<li>error：异常处理模块，若出现请求错误，可以捕获这些异常，然后进行重试或其他操作保证程序不会意外终止</li>
<li>parse：工具模块，提供URL处理方法，比如拆分、解析、合并等</li>
<li>robotparser：识别网站的robots.txt文件</li>
</ul>
</li>
<li><p>发送请求</p>
<ul>
<li><p>urlopen()</p>
<p>urllib.request.urlopen(url,data=None,[timeout,]*,cafile=None,capath=None,cadefault=False,context=None)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">response = urllib.request.urlopen(<span class="string">'https://www.python.org'</span>)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出为HTTPResponse类型对象，主要包含read()、readinto()、getheader(name)、getheaders()、fileno()等方法</span></span><br><span class="line"><span class="comment"># msg、version、status、reason、debuglevel、closed属性等</span></span><br><span class="line">print(type(response))</span><br><span class="line">print(response.status)</span><br><span class="line">print(response.getheaders())</span><br><span class="line">print(response.getheader(<span class="string">'Server'</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>data参数</li>
<li>timeout参数</li>
<li>其他参数</li>
</ul>
</li>
<li><p>Request</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">request = urllib.request.Request(<span class="string">'https://python.org'</span>)</span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<p>依然通过urlopen()方法来发送请求，但是该方法的参数不再是URL。而是一个request类型的对象。这样可以将请求独立成一个对象，也可以灵活地配置参数。</p>
<p>class urllib.request.Request(url,data=None,headers={},origin_req_host=None,unverifiable=False,method=None)</p>
<ul>
<li>url：用于请求URL，这是必传参数，其他都是可选参数。</li>
<li>data：必须传bytes(字节流)类型的参数。如果是字典，可以通过rullib.parse模块里的urlencode()编码。</li>
<li>headers：该参数是一个字典，它就是请求头，可以直接构造，也可以通过调用请求实例的add_headers()方法添加。</li>
<li>origin_req_host：指的是请求方的host名称或IP地址。</li>
<li>unverifiable：表示这个请求是否是无法验证的，默认是False。例如，我们请求一个HTML文档中的图片，但是我们没有自动抓取图像的权限，这时unverifiable的值就是True。</li>
<li>method：用来指示请求使用的方法，比如GET、POST和PUT等。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request,parse</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://httpbin.rog/post'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>:<span class="string">'...'</span>,</span><br><span class="line">    <span class="string">'Host'</span>:<span class="string">'httpbin.org'</span></span><br><span class="line">&#125;</span><br><span class="line">dict = &#123;</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'Germey'</span></span><br><span class="line">&#125;</span><br><span class="line">data = bytes(parse.urlencode(dict),encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">req = request.Request(url=urll,data=data,headers=headers,method=<span class="string">'POST'</span>)</span><br><span class="line"><span class="comment"># 使用add_headers()方法添加</span></span><br><span class="line"><span class="comment"># req = request.Request(url=urll,data=data,method='POST')</span></span><br><span class="line"><span class="comment"># req.add_headers('User-Agent','Mozilla/4.0...')</span></span><br><span class="line">response = request.urlopen(req)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>高级用法</p>
</li>
</ul>
</li>
<li><p>处理异常</p>
<ul>
<li>URLError</li>
<li>HTTPError</li>
</ul>
</li>
<li><p>解析链接</p>
</li>
<li><p>分析Robots协议</p>
</li>
</ul>
<h3 id="3-2-使用requests"><a href="#3-2-使用requests" class="headerlink" title="3.2 使用requests"></a>3.2 使用requests</h3><ul>
<li><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pip3</span> install requests</span><br></pre></td></tr></table></figure>
</li>
<li><p>实例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">r.encoding = r.apparent_encoding</span><br><span class="line">print(type(r))</span><br><span class="line">print(r.status_code)</span><br><span class="line">print(type(r.text))</span><br><span class="line">print(r.text)</span><br><span class="line">print(r.cookies)</span><br><span class="line"></span><br><span class="line">r= requests.post(<span class="string">'http://httpbin.org/post'</span>)</span><br><span class="line">r= requests.put(<span class="string">'http://httpbin.org/put'</span>)</span><br><span class="line">r= requests.delete(<span class="string">'http://httpbin.org/delete'</span>)</span><br><span class="line">r= requests.head(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">r= requests.options(<span class="string">'http://httpbin.org/get'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>GET请求</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://www.httpbin.org/get'</span>)</span><br><span class="line">print(r.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加参数</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'germey'</span>,</span><br><span class="line">    <span class="string">'age'</span>:<span class="number">22</span></span><br><span class="line">&#125;</span><br><span class="line">r = requests.get(<span class="string">'http://httpbin.org/get'</span>,params=data)</span><br><span class="line">print(r.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接解析返回结果，可以得到一个字典格式的结果</span></span><br><span class="line">print(r.json())</span><br><span class="line">print(type(r.json()))</span><br></pre></td></tr></table></figure>
<ul>
<li><p>抓取知乎发现页标题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.84 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">r = requests.get(<span class="string">'https://www.zhihu.com/explore'</span>,headers=headers)</span><br><span class="line">pattern = re.compile(<span class="string">'explore-feed.*?question_link.*?&gt;(.*?)&lt;/a&gt;'</span>,re.S)</span><br><span class="line">titles = re.findall(pattern,r.text)</span><br><span class="line">print(titles)</span><br></pre></td></tr></table></figure>
</li>
<li><p>抓取二进制数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://github.com/favicon'</span>)</span><br><span class="line">print(r.content)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'pic.jpg'</span>,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(r.content)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>POST请求</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">'name'</span>:<span class="string">'germey'</span>,<span class="string">'age'</span>:<span class="number">22</span>&#125;</span><br><span class="line"><span class="comment"># 提交数据到form，说明POST请求成功</span></span><br><span class="line">r = requests.post(<span class="string">'http://httpbin.org/post'</span>,data=data)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>
</li>
<li><p>响应</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.84 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">r = requests.get(<span class="string">'http://www.jianshu.com'</span>,headers=headers)</span><br><span class="line">print(type(r.status_code),r.status_code)</span><br><span class="line"><span class="comment"># headers属性得到的结果CaseInsensitiveDict</span></span><br><span class="line">print(type(r.headers),r.headers)</span><br><span class="line"><span class="comment"># cookies属性得到的结果RequestsCookieJar</span></span><br><span class="line">print(type(r.cookies),r.cookies)</span><br><span class="line">print(type(r.url),r.url)</span><br><span class="line">print(type(r.history),r.history)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 内置的状态码查询对象requests.codes</span></span><br><span class="line">exit() <span class="keyword">if</span> <span class="keyword">not</span> r.status_code == requests.codes.ok <span class="keyword">else</span> print(<span class="string">'successs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print('fault') if r.status_code == requests.codes.not_found else exit()</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>高级用法</p>
<ul>
<li><p>文件上传</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">files = &#123;<span class="string">'file'</span>:open(<span class="string">'favicon.icon'</span>,<span class="string">'rb'</span>)&#125;</span><br><span class="line">r = requests.post(<span class="string">'http://httpbin.org/post'</span>,files=files)</span><br><span class="line">print(r.text)</span><br><span class="line">print(r.status_code)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Cookies设置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">print(r.cookies)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key,value <span class="keyword">in</span> r.cookies.items():</span><br><span class="line">    print(key + <span class="string">'='</span> + value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用Cookies维持登录状态</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'Cookie'</span>:<span class="string">'......'</span>,</span><br><span class="line">    <span class="string">'Host'</span>:<span class="string">'www.zhihu.com'</span>,</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.84 Safari/537.36'</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">r = requests.get(<span class="string">'https://www.zhihu.com'</span>,headers=headers)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>
</li>
<li><p>会话维持</p>
<p>使用Session对象维持会话，可以做到模拟同一个会话二不用担心Cookies的问题。通常用于模拟登录成功后再进行下一步的操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">s.get(<span class="string">'http://httpbin.org/cookies/set/number/123456789'</span>)</span><br><span class="line">r = s.get(<span class="string">'http://httpbin.org/cookies'</span>)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>
</li>
<li><p>SSL证书验证</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="comment"># from requests.packages import urllib3</span></span><br><span class="line"><span class="comment"># 忽略警告</span></span><br><span class="line"><span class="comment"># urllib3.disable_warnings()</span></span><br><span class="line"><span class="comment"># 捕获警告到日志</span></span><br><span class="line">logging.captureWarnings(<span class="keyword">True</span>)</span><br><span class="line">r = requests.get(<span class="string">'https://www.12306.cn'</span>,verify=<span class="keyword">False</span>)</span><br><span class="line"><span class="comment"># 或指定本地证书用作客户端证书</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">print(r.status_code)</span><br></pre></td></tr></table></figure>
</li>
<li><p>代理设置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment">#proxies = &#123;</span></span><br><span class="line"><span class="comment">#    'http':'http://10.10.1.10:3128',</span></span><br><span class="line"><span class="comment">#    'https':'http://10.10.1.10:1080'</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>:<span class="string">'http://user:password@10.10.1.10:3128/'</span>,</span><br><span class="line">&#125;</span><br><span class="line">requests.get(<span class="string">'https://www.taobao.com'</span>,proxies=proxies)</span><br></pre></td></tr></table></figure>
</li>
<li><p>超时设置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># timeout=None则为永久等待，或直接不加参数</span></span><br><span class="line">r = requests.get(<span class="string">'https://www.taobao.com'</span>,timeout = <span class="number">1</span>)</span><br><span class="line">print(r.status_code)</span><br></pre></td></tr></table></figure>
</li>
<li><p>身份认证</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http:localhost:5000'</span>,auth=(<span class="string">'username'</span>,<span class="string">'password'</span>))</span><br><span class="line">print(r.status_code)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Prepared Requests</p>
<p>在requests中将请求表示为数据结构，这个数据结构就叫Prepared Requests</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> Request,Session</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://httpbin.org/post'</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'germey'</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.84 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">s = Session()</span><br><span class="line">req = Request(<span class="string">'POST'</span>,url,data=data,headers=headers)</span><br><span class="line">prepped = s.prepare_request(req)</span><br><span class="line">r = s.send(prepped)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-3-正则表达式"><a href="#3-3-正则表达式" class="headerlink" title="3.3 正则表达式"></a>3.3 正则表达式</h3><ul>
<li><p>常用匹配规则</p>
<p>| 模式   | 描述                                                         |<br>| —— | ———————————————————— |<br>| \w     | 匹配字母、数字及下划线                                       |<br>| \W     | 匹配不是字母、数字及下划线的字符                             |<br>| \s     | 匹配任意空白字符，等价于[\t\n\r\f]                           |<br>| \S     | 匹配任意非空字符                                             |<br>| \d     | 匹配任意数字，等价于[0-9]                                    |<br>| \D     | 匹配任意非数字字符                                           |<br>| \A     | 匹配字符串开头                                               |<br>| \Z     | 匹配字符串结尾，若存在换行，只匹配到换行前的结束字符串       |<br>| \z     | 匹配字符串结尾，若存在换行，同时还会匹配换行符               |<br>| \G     | 匹配最后匹配完成的位置                                       |<br>| \n     | 匹配一个换行符                                               |<br>| \t     | 匹配一个制表符                                               |<br>| ^      | 匹配一行字符串的开头                                         |<br>| $      | 匹配一行字符串的结尾                                         |<br>| .      | 匹配任意字符，除了换行符，当re.DOTALL标记被指定时，则可以匹配包括换行符的任意字符 |<br>| […]  | 用来表示一组字符串，单独列出，比如[amk]匹配a、m或k           |<br>| [^…] | 不在[]中的字符，比如[^abc]匹配除了a、b、c之外的字符         |<br>| *      | 匹配0个或多个表达式                                          |<br>| +      | 匹配1个或多个表达式                                          |<br>| ?      | 匹配0个或1个前面的正则表达式定义的片段，非贪婪方式           |<br>| {n}    | 精确匹配n个前面的正则表达式                                  |<br>| {n,m}  | 匹配n到m次由前面正则表达式定义的片段，贪婪方式               |<br>| a|b   | 匹配a或b                                                     |<br>| ()     | 匹配括号内的表达式，页表示一个组                             |</p>
</li>
<li><p>match()</p>
<p>match()会从字符串的起始位置匹配正则表达式，如果匹配，返回匹配成功的结果；若不匹配，则返回None</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Hello 123 4567 World_This is a Regex Demo'</span></span><br><span class="line">print(len(content))</span><br><span class="line"></span><br><span class="line">result = re.match(<span class="string">'^Hello\s\d\d\d\s\d&#123;4&#125;\s\w&#123;10&#125;'</span>,content)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># group()可以输出匹配到的内容</span></span><br><span class="line">print(result.group())</span><br><span class="line"><span class="comment"># span()输出匹配结果在原字符串中的的位置范围，</span></span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure>
<ul>
<li><p>匹配目标</p>
<p>可以使用括号()将想要提取的子字符串括起来。()实际上标记了一个表达式的开始和结束位置，被标记的每个子表达式会依次对应每一个分组，调用group()方法传入分组的索引即可获取提取的结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">result = re.match(<span class="string">'^Hello\s(.*?)\sWorld'</span>,content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group())</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure>
</li>
<li><p>通用匹配</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># .*可以匹配任意字符</span></span><br><span class="line">result = re.match(<span class="string">'^Hello.*Demo$'</span>,content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group())</span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure>
</li>
<li><p>贪婪与非贪婪</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行结果只得到7，在贪婪匹配中，.*会匹配尽可能多的字符，\d+代表至少一个数字，</span></span><br><span class="line"><span class="comment"># 所以.*尽可能的匹配多的字符，因此只留下一个可满足条件的数字7</span></span><br><span class="line">result = re.match(<span class="string">'^He.*(\d+).*Demo$'</span>,content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># .*?是非贪婪匹配，就是尽可能匹配少的字符</span></span><br><span class="line">result = re.match(<span class="string">'^He.*?(\d+).*Demo$'</span>,content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">content = <span class="string">'http://weibo.com/comment/kEraCN'</span></span><br><span class="line">result1 = re.match(<span class="string">'http.*?comment/(.*?)'</span>,comment)</span><br><span class="line">result2 = re.match(<span class="string">'http.*?comment/(.*)'</span>,comment)</span><br><span class="line">print(<span class="string">'result1'</span>,result1.group(<span class="number">1</span>))</span><br><span class="line">print(<span class="string">'result2'</span>,result1.group(<span class="number">2</span>))</span><br><span class="line"><span class="comment"># 运行结果为</span></span><br><span class="line"><span class="comment"># result1</span></span><br><span class="line"><span class="comment"># result2 kEraCN</span></span><br><span class="line"><span class="comment"># .*?没有匹配到任何结果，.*尽量匹配多的内容，因此成功匹配</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修饰符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">''''Hello 1234567 World_This </span></span><br><span class="line"><span class="string">is a Regex Demo'''</span></span><br><span class="line"><span class="comment"># 运行报错，因为这个正则表达式无法匹配到换行符，所以返回结果None</span></span><br><span class="line"><span class="comment"># result = re.match('^He.*?(\d+).*?Demo$',content)</span></span><br><span class="line"><span class="comment"># print((result.group(1)))</span></span><br><span class="line"><span class="comment"># 添加re.S即可修正此错误，这个修饰符可以匹配包括换行符在内的所有字符</span></span><br><span class="line">result = re.match(<span class="string">'^He.*?(\d+).*?Demo$'</span>,content，re.S)</span><br><span class="line">print((result.group(<span class="number">1</span>)))</span><br></pre></td></tr></table></figure>
<p>| 修饰符 | 描述                                                       |<br>| —— | ———————————————————- |<br>| re.I   | 使匹配对大小写不敏感                                       |<br>| re.L   | 做本地化识别匹配                                           |<br>| re.M   | 多行匹配，影响^和$                                         |<br>| re.S   | 使.匹配包括换行在内的所有字符                              |<br>| re.U   | 根据Unicode字符集解析字符。这个标志影响\w、\W、\b、\B      |<br>| re.X   | 该标志通过给予更灵活的格式以便你将正则表达式写得更易于理解 |</p>
</li>
<li><p>转义匹配</p>
<p>若目标字符串里包含.,，则需要用到转义匹配</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'(百度)www.baidu.com'</span></span><br><span class="line">result = re.match(<span class="string">'\(百度\)www\.baidu\.com'</span>,content)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>search()</p>
<p>match()方法是从字符串的开头开始匹配的，一旦开头不匹配，name整个匹配就失败了。search()在匹配时会扫描整个字符串，然后返回第一个成功匹配的结果。若搜索完成还未找打，则返回None</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Extra stings Hello 1234567 World_This is a Regex Demo Extra stings'</span></span><br><span class="line">result = re.match(<span class="string">'Hello.*?(\d+).*?Demo'</span>,content)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># None</span></span><br><span class="line"></span><br><span class="line">result = re.search(<span class="string">'Hello.*?(\d+).*?Demo'</span>,content)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">    &lt;div id="songs-list"&gt;</span></span><br><span class="line"><span class="string">        &lt;h2 class="title"&gt;经典老歌&lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &lt;p class="introduction"&gt;</span></span><br><span class="line"><span class="string">            经典老歌列表</span></span><br><span class="line"><span class="string">        &lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;ul id="list" class="list-group"&gt;</span></span><br><span class="line"><span class="string">            &lt;li data-view="2"&gt;一路有你&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li data-view="7"&gt;</span></span><br><span class="line"><span class="string">                &lt;a&gt;沧海一声笑&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li data-view="4" class="active"&gt;</span></span><br><span class="line"><span class="string">                &lt;a href="/5.mp3" singer="齐秦"&gt;随风往事&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li data-view="6"&gt;</span></span><br><span class="line"><span class="string">                &lt;a href="/5.mp3" singer="beyond"&gt;光辉岁月&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li  data-view="5"&gt;</span></span><br><span class="line"><span class="string">                &lt;a href="/5.mp3" singer="陈慧琳"&gt;记事本&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li  data-view="5"&gt;</span></span><br><span class="line"><span class="string">                &lt;a href="/.6mp3" singer="邓丽君"&gt;但愿人长久&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">result = re.search(<span class="string">'&lt;li.*?active.*?singer="(.*?)"&gt;(.*?)&lt;/a&gt;'</span>,html,re.S)</span><br><span class="line">print(result.group(<span class="number">1</span>),result.group(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若不加active</span></span><br><span class="line">result = re.search(<span class="string">'&lt;li.*?singer="(.*?)"&gt;(.*?)&lt;/a&gt;'</span>,html,re.S)</span><br><span class="line"><span class="comment"># 则返回匹配的第一条结果</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>findall()</p>
<p>findall()会搜索整个字符串，然后返回匹配正则表达式的所有内容，返回的是列表类型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">result = re.findall(<span class="string">'&lt;li.*?href="(.*?)".*?singer="(.*?)"&gt;(.*?)&lt;/a&gt;'</span>,html,re.S)</span><br><span class="line">print(type(result))</span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> result:</span><br><span class="line">    print(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回的列表中的每个元素都是元祖类型，用对应的索引一次取出即可。</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>sub()</p>
<p>除了使用正则表达式提取信息外，有时候还需要借助它来修改文本。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'54aK54yr5oiR54ix5L2g'</span></span><br><span class="line"><span class="comment"># 第一个参数\d+用来匹配所有的数字，第二个参数为替换成的字符串，第三个参数为原字符串</span></span><br><span class="line">content = re.sub(<span class="string">'\d+'</span>,<span class="string">''</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上面的HTML文本也可以直接使用正则表达式修改之后再进行提取，就会简单很多了</span></span><br><span class="line">result = re.sub(<span class="string">'&lt;a.*?&gt;|&lt;/a&gt;'</span>,<span class="string">''</span>,html)</span><br><span class="line">print(result)</span><br><span class="line">results = re.findall(<span class="string">'&lt;li.*?&gt;(.*?)&lt;/li&gt;'</span>,result,re.S)</span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span>  results:</span><br><span class="line">    print(result.strip())</span><br></pre></td></tr></table></figure>
</li>
<li><p>compile()</p>
<p>compile()可以将正则字符串编译成正则表达式对象，以便在后面的匹配中复用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content1 = <span class="string">'2016-12-15 12:00'</span></span><br><span class="line">content2 = <span class="string">'2016-12-17 12:55'</span></span><br><span class="line">content3 = <span class="string">'2016-12-22 13:21'</span></span><br><span class="line"><span class="comment"># 还可以将修饰符传入，这样在search()、findall()方法中就不需要额外传了</span></span><br><span class="line">pattern = re.compile(<span class="string">'\d&#123;2&#125;:\d&#123;2&#125;'</span>)</span><br><span class="line">result1 = re.sub(pattern,<span class="string">''</span>,content1)</span><br><span class="line">result2 = re.sub(pattern,<span class="string">''</span>,content2)</span><br><span class="line">result3 = re.sub(pattern,<span class="string">''</span>,content3)</span><br><span class="line">print(result1,result2,result3)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="3-4-抓取猫眼电影排行"><a href="#3-4-抓取猫眼电影排行" class="headerlink" title="3.4 抓取猫眼电影排行"></a>3.4 抓取猫眼电影排行</h3><ul>
<li><p>目标：提取出猫眼电影TOP100的电影名称、时间、评分、图片等信息，提取的站点URL为<a href="http://maoyan.com/board/4" target="_blank" rel="noopener">http://maoyan.com/board/4</a>，提取结果 会以文件形式保存下来。</p>
</li>
<li><p>分析</p>
<ul>
<li>目标站点：<a href="http://maoyan.com/board/4" target="_blank" rel="noopener">http://maoyan.com/board/4</a></li>
<li>第二页：<a href="http://maoyan.com/board/4?offset=10" target="_blank" rel="noopener">http://maoyan.com/board/4?offset=10</a></li>
</ul>
<ol>
<li><p>抓取首页实现get_one_page(url)</p>
</li>
<li><p>正则表达式提取：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'\&lt;dd&gt;.*?board-index.*?&gt;(.*?)\&lt;/i&gt;.*?data-src="(.*?)".*?name.*?a.*?&gt;(.*?)\&lt;/a&gt;.*?"star".*?&gt;(.*?)\&lt;/p&gt;.*?"releasetime".*?&gt;(.*?)\&lt;/p&gt;.*?"integer".*?&gt;(.*?)\&lt;/i&gt;.*?"fraction".*?&gt;(.*?)\&lt;/i&gt;.*?\&lt;/dd&gt;'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>写入文件</p>
</li>
<li><p>分页爬取</p>
</li>
<li><p>运行代码</p>
</li>
</ol>
</li>
<li><p>代码</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36'</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.get(url,headers=headers)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_one_page</span><span class="params">(html)</span>:</span></span><br><span class="line">    pattern = re.compile(<span class="string">'&lt;dd&gt;.*?board-index.*?&gt;(.*?)&lt;/i&gt;.*?data-src="(.*?)".*?name.*?a.*?&gt;(.*?)&lt;/a&gt;.*?"star".*?&gt;(.*?)&lt;/p&gt;.*?"releasetime".*?&gt;(.*?)&lt;/p&gt;.*?"integer".*?&gt;(.*?)&lt;/i&gt;.*?"fraction".*?&gt;(.*?)&lt;/i&gt;.*?&lt;/dd&gt;'</span>,re.S)</span><br><span class="line">    items = re.findall(pattern,html)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">yield</span> &#123;</span><br><span class="line">            <span class="string">'index'</span>:item[<span class="number">0</span>],</span><br><span class="line">            <span class="string">'image'</span>:item[<span class="number">1</span>],</span><br><span class="line">            <span class="string">'title'</span>:item[<span class="number">2</span>],</span><br><span class="line">            <span class="string">'actor'</span>:item[<span class="number">3</span>].strip()[<span class="number">3</span>:],</span><br><span class="line">            <span class="string">'time'</span>:item[<span class="number">4</span>].strip()[<span class="number">5</span>:],</span><br><span class="line">            <span class="string">'score'</span>:item[<span class="number">5</span>] + item[<span class="number">6</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_file</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'result.txt'</span>,<span class="string">'a'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(json.dumps(content,ensure_ascii=<span class="keyword">False</span>) + <span class="string">'\n'</span>)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(offset)</span>:</span></span><br><span class="line">    url = <span class="string">'http://maoyan.com/board/4?offset='</span> + str(offset)</span><br><span class="line">    html = get_one_page(url)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> parse_one_page(html):</span><br><span class="line">        write_to_file(item)</span><br><span class="line">        print(item)</span><br><span class="line">    <span class="comment"># print(html)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    pool = Pool()</span><br><span class="line">    pool.map(main,[i * <span class="number">10</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)])</span><br></pre></td></tr></table></figure>
<h3 id="练习：抓取豆瓣top250电影排行"><a href="#练习：抓取豆瓣top250电影排行" class="headerlink" title="练习：抓取豆瓣top250电影排行"></a>练习：抓取豆瓣top250电影排行</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36'</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.get(url,headers=headers)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_one_page</span><span class="params">(html)</span>:</span></span><br><span class="line">    pattern = re.compile(<span class="string">'&lt;li&gt;.*?class=""&gt;(.*?)&lt;/em&gt;.*?"title"&gt;(.*?)&lt;/span&gt;.*?average"&gt;(.*?)&lt;/span&gt;.*?inq"&gt;(.*?)&lt;/span&gt;.*?&lt;/li&gt;'</span>,re.S)</span><br><span class="line">    items = re.findall(pattern,html)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">yield</span> &#123;</span><br><span class="line">            <span class="string">'index'</span>:item[<span class="number">0</span>],</span><br><span class="line">            <span class="string">'title'</span>:item[<span class="number">1</span>],</span><br><span class="line">            <span class="string">'score'</span>:item[<span class="number">2</span>],</span><br><span class="line">            <span class="string">'quote'</span>:item[<span class="number">3</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_file</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'douban.txt'</span>,<span class="string">'a'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(json.dumps(content,ensure_ascii=<span class="keyword">False</span>) + <span class="string">'\n'</span>)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(start)</span>:</span></span><br><span class="line">    url = <span class="string">"https://movie.douban.com/top250?start="</span> + str(start)</span><br><span class="line">    html = get_one_page(url)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> parse_one_page(html):</span><br><span class="line">        <span class="comment"># print(item)</span></span><br><span class="line">        write_to_file(item)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># for i in range(10):</span></span><br><span class="line">    <span class="comment">#     main(i * 25)</span></span><br><span class="line">    pool = Pool()</span><br><span class="line">    pool.map(main, [i * <span class="number">25</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)])</span><br></pre></td></tr></table></figure>
<h2 id="四、解析库的使用"><a href="#四、解析库的使用" class="headerlink" title="四、解析库的使用"></a>四、解析库的使用</h2><h3 id="4-1-使用XPath"><a href="#4-1-使用XPath" class="headerlink" title="4.1 使用XPath"></a>4.1 使用XPath</h3><ul>
<li><p>常用规则</p>
<p>| 表达式   | 描述                     |<br>| ——– | ———————— |<br>| nodename | 选取此节点的所有子节点   |<br>| /        | 从当前节点选取直接子节点 |<br>| //       | 从当前节点选取子孙节点   |<br>| .        | 选取当前节点             |<br>| ..       | 选取当前节点的父节点     |<br>| @        | 选取属性                 |</p>
<p>栗子：//title[@lang=’eng’] —— 代表选择所有名称为title，同时属性lang的值为eng的节点</p>
</li>
<li><p>实例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">text = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;ul&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-0"&gt;&lt;a href="link1.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-inactive"&gt;&lt;a href="link3.html"&gt;third item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-0"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-1"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line"><span class="comment"># tostring输出结果为bytes类型，这里利用decode()方法将其转成str类型</span></span><br><span class="line">result = etree.tostring(html)</span><br><span class="line">print(result.decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>所有节点</p>
<p>我们一般会用//开头的XPath规则来选取所有符合要求的节点。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line"><span class="comment"># 这里的*代表匹配所有节点，即整个HTML文本中的所有节点都会被获取</span></span><br><span class="line">result = html.xpath(<span class="string">'//*'</span>)</span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line"><span class="comment"># 这里选取所有li节点，直接在//后加上节点名称即可</span></span><br><span class="line">result = html.xpath(<span class="string">'//li'</span>)</span><br><span class="line">print(result)</span><br><span class="line">print(result[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
</li>
<li><p>子节点</p>
<p>通过/或//即可查找子节点或子孙节点</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line"><span class="comment"># 选择li节点的所有直接a子节点</span></span><br><span class="line">result = html.xpath(<span class="string">'//li/a'</span>)</span><br><span class="line">print(result[<span class="number">0</span>].text)</span><br><span class="line"></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//ul//a'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
</li>
<li><p>父节点</p>
<p>通过..可以查找父节点</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//a[@href="link4.html"]/../@class'</span>)</span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line"><span class="comment"># 也可以通过parent::获取父节点</span></span><br><span class="line">result = html.xpath(<span class="string">'//a[@href="link4.html"]/parent::*/@class'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
</li>
<li><p>属性匹配</p>
<p>可以用@符号进行属性过滤</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//li[@class="item-0"]'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
</li>
<li><p>文本获取</p>
<p>XPath中的text()方法可以获取节点中的文本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先选取a节点再获取文本</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//li[@class="item-0"]/a/text()'</span>)</span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用//</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//li[@class="item-0"]//text()'</span>)</span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接用//加text()的方式，可以保证获取到最全面的文本信息，但是可能会夹杂一些换行符等特殊字符</span></span><br><span class="line"><span class="comment"># 如果想要获取某些特定子孙节点下的所有文本，可以先选取到特定的子孙节点，再调用text()方法获取其内部文本，这样可以保证获取到的结果是整洁的</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>属性获取</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//li/a/@href'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
</li>
<li><p>属性多值匹配</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">text = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;li class="li li-first"&gt;&lt;a href="link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//li[contains(@class,"li")]/a/text()'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
</li>
<li><p>多属性匹配</p>
<p>需要同时匹配多个属性，可以使用运算符and来连接</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">text = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;li class="li li-first" name="item"&gt;&lt;a href="link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//li[contains(@class,"li") and @name="item"]/a/text()'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
<p>| 运算符 | 描述           | 实例               | 返回值                           |<br>| —— | ————– | —————— | ——————————– |<br>| or     | 或             | age=19 or age=20   | 19-true,21-false                 |<br>| and    | 与             | age&gt;19 and age &lt;21 | 20-true,22-false                 |<br>| mod    | 除法的余数     | 5 mod 2            | 1                                |<br>| |     | 计算两个节点集 | //book | //cd     | 返回所有拥有book和cd元素的节点集 |<br>| +      | 加法           | 6+4                | 10                               |<br>| -      | 减法           | 6-4                | 2                                |<br>| <em>      | 乘法           | 6</em>4                | 24                               |<br>| div    | 除法           | 8 div 4            | 2                                |<br>| =      | 等于           | age=19             | 19-true,20-false                 |<br>| !=     | 不等于         | age!=19            | 19-false,18-true                 |<br>| &lt;      | 小于           | age&lt;19             | 19-false,18-false                |<br>| &lt;=     | 小于或等于     | age&lt;=19            | 19-true,20-false                 |<br>| &gt;      | 大于           | age&gt;19             | 19-false,21-true                 |<br>| &gt;=     | 大于或等于     | age&gt;=19            | 19-true,18-false                 |</p>
</li>
<li><p>按序选择</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">text = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;ul&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-0"&gt;&lt;a href="link1.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-inactive"&gt;&lt;a href="link3.html"&gt;third item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-0"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-1"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/a/text()'</span>)</span><br><span class="line">print(result)</span><br><span class="line">result = html.xpath(<span class="string">'//li[last()]/a/text()'</span>)</span><br><span class="line">print(result)</span><br><span class="line">result = html.xpath(<span class="string">'//li[last()-2]/a/text()'</span>)</span><br><span class="line">print(result)</span><br><span class="line">result = html.xpath(<span class="string">'//li[position()&lt;3]/a/text()'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
</li>
<li><p>节点轴选择</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line">text = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;ul&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-0"&gt;&lt;a href="link1.html"&gt;first item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-inactive"&gt;&lt;a href="link3.html"&gt;third item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-0"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li class="item-1"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">html = etree.HTML(text)</span><br><span class="line"><span class="comment"># ancestor可以获取祖先节点，其后需要跟两个冒号，*匹配所有节点</span></span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/ancestor::*'</span>)</span><br><span class="line">print(result)</span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/ancestor::div'</span>)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># attribute获取所有属性值</span></span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/attribute::*'</span>)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># child获取所有直接子节点</span></span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/child::a[@href="link1.html"]'</span>)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># descendant可以获取所有子孙节点</span></span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/descendant::span'</span>)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># following可以获取当前节点之后的所有节点，可以使用索引</span></span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/following::*[2]'</span>)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># following-sibling可以获取当前节点之后的所有同级节点</span></span><br><span class="line">result = html.xpath(<span class="string">'//li[1]/following-sibling::*'</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="http://www.w3school.com.cn/xpath/index.asp" target="_blank" rel="noopener">更多参考</a></p>
</blockquote>
</li>
</ul>
<h3 id="4-2-使用BeautifulSoup"><a href="#4-2-使用BeautifulSoup" class="headerlink" title="4.2 使用BeautifulSoup"></a>4.2 使用BeautifulSoup</h3><p>Beautiful  Soup就是Python的一个HTML或XML的解析库，可以用它来方便地从网页中提取数据</p>
<ul>
<li><p>基本用法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang="en"&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Document&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;p class="title" name="dromouse"&gt;</span></span><br><span class="line"><span class="string">        &lt;b&gt;The Dormouse's story&lt;/b&gt;</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p class="story"&gt;</span></span><br><span class="line"><span class="string">        Once upon a time there were three little sisters;and their names were</span></span><br><span class="line"><span class="string">        &lt;a href="http://example.com/elsie" class="sister" id="link1"&gt;</span></span><br><span class="line"><span class="string">            &lt;!-- Elsie --&gt;</span></span><br><span class="line"><span class="string">        &lt;/a&gt;,</span></span><br><span class="line"><span class="string">        &lt;a href="http://example.com/lacie" class="sister" id="link2"&gt;Lacie&lt;/a&gt; and</span></span><br><span class="line"><span class="string">        &lt;a href="http://example.com/tillie" class="sister" id="link2"&gt;Tillie&lt;/a&gt;; and they lived at the bottom of a well.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p class="story"&gt;</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.prettify())</span><br><span class="line">print(soup.title.string)</span><br></pre></td></tr></table></figure>
</li>
<li><p>节点选择器</p>
<ul>
<li><p>选择元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print(soup.title)</span><br><span class="line">print(type(soup.title))</span><br><span class="line">print(soup.title.string)</span><br><span class="line">print(soup.head)</span><br><span class="line"><span class="comment"># 当存在多个节点，这种选择方式只会选择第一个匹配的节点</span></span><br><span class="line">print(soup.p)</span><br></pre></td></tr></table></figure>
</li>
<li><p>提取信息</p>
<ol>
<li>获取名称</li>
<li>获取属性</li>
<li>获取内容</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print(soup.title.name)</span><br><span class="line"></span><br><span class="line">print(soup.p.attrs)</span><br><span class="line">print(soup.p.attrs[<span class="string">'name'</span>])</span><br><span class="line"></span><br><span class="line">print(soup.p.b.string)</span><br></pre></td></tr></table></figure>
</li>
<li><p>嵌套选择</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(soup.head.title)</span><br><span class="line">print(type(soup.head.title))</span><br><span class="line">print(soup.head.title.string)</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联选择 —— 先选中某一节点元素，然后以它为基准再选择它的子节点、父节点、兄弟节点等</p>
<ul>
<li>子节点和孙节点</li>
</ul>
</li>
</ul>
</li>
<li><p>方法选择器</p>
</li>
<li><p>CSS选择器</p>
</li>
</ul>
<h3 id="4-3-使用pyquery"><a href="#4-3-使用pyquery" class="headerlink" title="4.3 使用pyquery"></a>4.3 使用pyquery</h3><h2 id="五、数据存储"><a href="#五、数据存储" class="headerlink" title="五、数据存储"></a>五、数据存储</h2><h3 id="5-1-文件存储"><a href="#5-1-文件存储" class="headerlink" title="5.1 文件存储"></a>5.1 文件存储</h3><h4 id="TXT存储"><a href="#TXT存储" class="headerlink" title="TXT存储"></a>TXT存储</h4><ul>
<li><p>实例：保存知乎上“发现”页面的“热门话题”部分，将其问题和答案统一保存成文本形式</p>
</li>
<li><p>使用requests获取网页源代码，使用pyquery解析库解析</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://www.zhihu.com/explore'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">  <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36'</span></span><br><span class="line">&#125;</span><br><span class="line">html = requests.get(url,headers=headers).text</span><br><span class="line">file_html = open(<span class="string">'explore.html'</span>,<span class="string">'a'</span>,encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">file_html.write(html)</span><br><span class="line">file_html.close()</span><br><span class="line">doc = pq(html)</span><br><span class="line">items = doc(<span class="string">'.explore-tab .feed-item'</span>).items()</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">  question = item.find(<span class="string">'h2'</span>).text()</span><br><span class="line">  author = item.find(<span class="string">'.author-link-line'</span>).text()</span><br><span class="line">  answer = pq(item.find(<span class="string">'.content'</span>).html()).text()</span><br><span class="line">  file = open(<span class="string">'explore.txt'</span>,<span class="string">'a'</span>,encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">  file.write(<span class="string">'\n'</span>.join([question,author,answer]))</span><br><span class="line">  file.write(<span class="string">'\n'</span> + <span class="string">'='</span> * <span class="number">50</span> + <span class="string">'\n'</span>)</span><br><span class="line">  file.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开方式</p>
<ul>
<li>r：以只读方式打开文件，文件指针将会放在文件的开头，默认模式</li>
<li>rb：以二进制只读方式打开，指针放在开头</li>
<li>r+：以读写方式打开。指针放在开头</li>
<li>rb+：以二进制读写方式打开，指针放在开头</li>
<li>w：以写入方式打开，若文件已存在，则覆盖，若文件不存在，则创建新的文件</li>
<li>wb：以二进制写入方式打开，则覆盖，若文件不存在，则创建新的文件</li>
<li>w+：以读写方式打开，若文件已存在，则覆盖，若文件不存在，则创建新的文件</li>
<li>wb+：以二进制读写方式打开，若文件已存在，则覆盖，若文件不存在，则创建新的文件</li>
<li>a：以追加方式打开，若该文件已存在，文件指针将会放在文件结尾。即新的内容会被写入到已有内容之后，若文件不存在，则创建新的文件写入</li>
<li>ab：以二进制追加方式打开，若该文件已存在，文件指针将会放在文件结尾。即新的内容会被写入到已有内容之后，若文件不存在，则创建新的文件写入</li>
<li>a+：以读写方式打开一个文件，若该文件已存在，文件指针将会放在文件结尾。文件打开时会是追加模式，若文件不存在，则创建新的文件写入</li>
<li>ab+：以二进制追加方式代开，若该文件已存在，文件指针将会放在文件结尾。即新的内容会被写入到已有内容之后，若文件不存在，则创建新的文件写入</li>
</ul>
</li>
<li><p>简化写法</p>
<ul>
<li><p>with as语法，在with控制块结束时，文件会自动关闭，就不需要再调用close()方法了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'explore.txt'</span>,<span class="string">'a'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(<span class="string">'\n'</span>.join([question,author,answer]))</span><br><span class="line">    file.write(<span class="string">'\n'</span> + <span class="string">'='</span> *<span class="number">50</span> + <span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="JSON文件存储"><a href="#JSON文件存储" class="headerlink" title="JSON文件存储"></a>JSON文件存储</h4><blockquote>
<p>JSON，全称JavaScript Object Notion，也就是JavaScript对象标记，它通过对象和数组的组合来表示数据，是一种轻量级的数据交换格式。</p>
</blockquote>
<ul>
<li><p>对象和数组</p>
<ul>
<li>对象：使用{}包裹起来的内容，数据结构为{key1:value1,key2:value2,…}的键值对结构。在面向对象的语言中，key为对象的属性，value为对应的值。键名可以使用整数和字符串表示。值得类型可以使任意类型。</li>
<li>数组：使用[]包裹起来的内容，数据结构为[“java”,”javascritpt”,”vb”,…]的索引结构。在JavaScript中，数组是一种比较特殊的数据类型，它也可以像对象那样使用键值对，但还是索引用的多。同样，值可以是任意类型。</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>:<span class="string">"bob"</span>,</span><br><span class="line">        <span class="attr">"gender"</span>:<span class="string">"male"</span>,</span><br><span class="line">        <span class="attr">"birthday"</span>:<span class="string">"today"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>:<span class="string">"selina"</span>,</span><br><span class="line">        <span class="attr">"gender"</span>:<span class="string">"female"</span>,</span><br><span class="line">        <span class="attr">"birthday"</span>:<span class="string">"tomorrow"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>读取JSON：通过dumps()方法将JSON对象转为文本字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">str = <span class="string">'''</span></span><br><span class="line"><span class="string">[</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        "name":"bob",</span></span><br><span class="line"><span class="string">        "gender":"male",</span></span><br><span class="line"><span class="string">        "birthday":"today"</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        "name":"selina",</span></span><br><span class="line"><span class="string">        "gender":"female",</span></span><br><span class="line"><span class="string">        "birthday":"tomorrow"</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">print(type(str))</span><br><span class="line">data = json.loads(str)</span><br><span class="line">print(data)</span><br><span class="line">print(type(json))</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加索引获得字典元素，通过调用键名即可得到键值</span></span><br><span class="line">data[<span class="number">0</span>][<span class="string">'name'</span>]</span><br><span class="line">data[<span class="number">0</span>].get(<span class="string">'name'</span>)</span><br><span class="line">data[<span class="number">0</span>].get(<span class="string">'age'</span>) <span class="comment"># None</span></span><br><span class="line">data[<span class="number">0</span>].get(<span class="string">'age'</span>,<span class="number">25</span>) <span class="comment"># default value = 25</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从JSON文本读取内容</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.json'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> file:</span><br><span class="line">    str = file.read()</span><br><span class="line">    data = json.loads(str)</span><br><span class="line">    print(data)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>JSON的数据需要用双引号来保卫，不能使用单引号，否则会出现JSONDecodeError错误</p>
</blockquote>
</li>
<li><p>输出JSON：调用dumps()方法将JSON对象转换为字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">data = [&#123;</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'王伟'</span>,</span><br><span class="line">    <span class="string">'gender'</span>:<span class="string">'male'</span>,</span><br><span class="line">    <span class="string">'birthday'</span>:<span class="string">'19920825'</span></span><br><span class="line">&#125;]</span><br><span class="line"><span class="comment"># 为了输出中文，还需要指定参数ensure_ascii=False,参数indent，代表缩进字符个数，另外还要规定文件输出的编码</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.json'</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(json.dumps(data,indent=<span class="number">2</span>,ensure_ascii=<span class="keyword">False</span>))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="CSV文件存储"><a href="#CSV文件存储" class="headerlink" title="CSV文件存储"></a>CSV文件存储</h4><blockquote>
<p>CSV，全称Comma-Separated Values，中文可以叫作逗号分隔值或字符分隔值，其文件以纯文本形式存储表格数据。该文件是一个字符序列，可以由任意数目的记录组成，记录间以某种换行符分隔。</p>
</blockquote>
<ul>
<li>写入</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="comment"># delimiter可以修改列与列之间的分隔符，writerrows可以同时写入多行，此时参数就需要为二位列表</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>,<span class="string">'w'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    writer = csv.writer(csvfile,delimiter=<span class="string">' '</span>)</span><br><span class="line">    writer.writerrow(<span class="string">'id'</span>,<span class="string">'name'</span>,<span class="string">'age'</span>)</span><br><span class="line">    writer.writerrows([[<span class="string">'1001'</span>,<span class="string">'mike'</span>,<span class="number">20</span>],[<span class="string">'1002'</span>,<span class="string">'bob'</span>,<span class="number">22</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入字典</span></span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    fieldnames = [<span class="string">'id'</span>,<span class="string">'name'</span>,<span class="string">'age'</span>]</span><br><span class="line">    writer = csv.DictWriter(csvfile,fieldnames=fieldnames)</span><br><span class="line">    writer.writeheader()</span><br><span class="line">    writer.writerow(&#123;<span class="string">'id'</span>:<span class="string">'1001'</span>,<span class="string">'name'</span>:<span class="string">'mike'</span>,<span class="string">'age'</span>:<span class="number">20</span>&#125;)</span><br><span class="line">    writer.writerows([&#123;<span class="string">'id'</span>:<span class="string">'1002'</span>,<span class="string">'name'</span>:<span class="string">'bob'</span>,<span class="string">'age'</span>:<span class="number">21</span>&#125;,&#123;<span class="string">'id'</span>:<span class="string">'1003'</span>,<span class="string">'name'</span>:<span class="string">'du'</span>,<span class="string">'age'</span>:<span class="number">25</span>&#125;])</span><br></pre></td></tr></table></figure>
<ul>
<li><p>读取</p>
<blockquote>
<p>这里构造的Reader对象，通过遍历输出了每行的内容，每一个行都是一个列表形式。如果文件中包含中文的话，还需要指定文件编码。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>,<span class="string">'r'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    reader = csv.reader(csvfile)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        print(row)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>也可以使用pandas中的read_csv()方法将数据从CSV中读取出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">df = pd.read_csv(<span class="string">'data.csv'</span>)</span><br><span class="line">print(df)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="5-2-关系型数据库存储"><a href="#5-2-关系型数据库存储" class="headerlink" title="5.2 关系型数据库存储"></a>5.2 关系型数据库存储</h3><blockquote>
<p>关系型数据库是基于关系模型的数据库，关系模型是通过二维表来保存的，所以它的存储方式就是行列组成的表，每一列就是一个字段，每一行就是一条记录。表可以看作某个实体的集合，而实体之间也存在联系，这就需要表与表之间的联系关系来体现，如主键外键的关联关系。多个表组成一个数据库，也就是关系型数据库。</p>
<p>关系型数据库有多种，如SQLite、MySQL、Oracle、SQL Server、DB2等。</p>
</blockquote>
<h4 id="MySQL存储"><a href="#MySQL存储" class="headerlink" title="MySQL存储"></a>MySQL存储</h4><ul>
<li><p>连接数据库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过PyMySQL的connect()方法声明一个MySQL连接duixiangdb</span></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>,user=<span class="string">'root'</span>,password=<span class="string">''</span>,port=<span class="number">3306</span>)</span><br><span class="line"><span class="comment"># 连接成功后调用cursor()获取MySQL的操作游标</span></span><br><span class="line">cursor = db.cursor()</span><br><span class="line"><span class="comment"># execute()方法执行sql语句</span></span><br><span class="line">cursor.execute(<span class="string">'SELECT VERSION()'</span>)</span><br><span class="line"><span class="comment"># 返回执行结果</span></span><br><span class="line">data = cursor.fetchone()</span><br><span class="line">print(<span class="string">'Database version:'</span>,data)</span><br><span class="line">cursor.execute(<span class="string">'CREATE DATABASE spiders DEFAULT CHARACTER SET UTF8'</span>)</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 代码格式化 command + alt + L</span></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">''</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">'CREATE TABLE IF NOT EXISTS students (id VARCHAR(255) NOT NULL ,name VARCHAR(255) NOT NULL,age INT NOT NULL,PRIMARY KEY (id))'</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>插入数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">id = <span class="string">'20120001'</span></span><br><span class="line">user = <span class="string">'bob'</span></span><br><span class="line">age = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">''</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"><span class="comment"># 使用构造SQL语句：sql = 'INSERT INTO student(id,name,age) values(' + id + ', ' + name + ', ' + age + ')'</span></span><br><span class="line"><span class="comment"># 使用格式化符%s实现，可以避免字符串拼接的麻烦，又可以避免引号冲突的问题</span></span><br><span class="line">sql = <span class="string">'INSERT INTO students(id,name,age) values(%s,%s,%s)'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql,(id,user,age))</span><br><span class="line">    <span class="comment"># 需要执行db对象的commit()方法才可实现数据插入，该方法可以将语句提交到数据库执行的方法</span></span><br><span class="line">    <span class="comment"># 对于数据插入、更新、删除操作，都需要调用该方法才能生效</span></span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="comment"># 如果执行失败，则调用rollback()执行数据回滚</span></span><br><span class="line">    db.rollback()</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    db.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>事务的4个属性（ACID）</p>
<p>|         属性          | 解释                                                         |<br>| :——————-: | :———————————————————– |<br>|  原子性（atomicity）  | 事务是一个不可分割的工作单位，事务中包括的诸操作要么都做，要么都不做 |<br>| 一致性（consistency） | 事务必须使数据库从一个一致性状态变到另一个一致性状态。一致性与原子性是密切相关的 |<br>|  隔离性（isolation）  | 一个事务的执行不能被其他事务干扰，即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能相互干扰 |<br>| 持久性（durability）  | 持久性也称永久性（permanence），指一个事务一旦提交，它对数据库的改变就应该是永久的。接下来的其他操作或故障不应该对其有任何影响 |</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">''</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"><span class="comment"># 优化</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'id'</span>:<span class="string">'20120002'</span>,</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'bob'</span>,</span><br><span class="line">    <span class="string">'age'</span>:<span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line">table = <span class="string">'students'</span></span><br><span class="line">keys = <span class="string">', '</span>.join(data.keys())</span><br><span class="line">values = <span class="string">', '</span>.join([<span class="string">'%s'</span>] * len(data))</span><br><span class="line">sql = <span class="string">'INSERT INTO &#123;table&#125;(&#123;keys&#125;) VALUES (&#123;values&#125;)'</span>.format(table=table,keys=keys,values=values)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> cursor.execute(sql,tuple(data.values())):</span><br><span class="line">        print(<span class="string">'successful'</span>)</span><br><span class="line">        db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">'failed'</span>)</span><br><span class="line">    db.rollback()</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    db.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>更新数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">''</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'id'</span>:<span class="string">'20120001'</span>,</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'bob'</span>,</span><br><span class="line">    <span class="string">'age'</span>:<span class="number">25</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">table = <span class="string">'students'</span></span><br><span class="line">keys = <span class="string">', '</span>.join(data.keys())</span><br><span class="line">values = <span class="string">', '</span>.join([<span class="string">'%s'</span>] * len(data))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ON DUPLICATE KEY UPDATE 如果主键存在，就执行更新操作</span></span><br><span class="line">sql = <span class="string">'INSERT INTO &#123;table&#125;(&#123;keys&#125;) VALUES(&#123;values&#125;) ON DUPLICATE KEY UPDATE'</span>.format(table=table,keys=keys,values=values)</span><br><span class="line">update = <span class="string">','</span>.join([<span class="string">" &#123;key&#125; = %s"</span>.format(key = key) <span class="keyword">for</span> key <span class="keyword">in</span> data])</span><br><span class="line">sql += update</span><br><span class="line"><span class="comment"># 若执行更新操作，则sql语句就是</span></span><br><span class="line"><span class="comment"># INSERT INTO students(id, name, age) VALUES(%s, %s, %s) ON DUPLICATE KEY UPDATE id = %s, name = %s, age = %s</span></span><br><span class="line"><span class="comment"># 这里就变成了6个%s，所以在后面的excute()方法的第二个参数元组就需要乘以2编程原来的2倍</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    print(sql)</span><br><span class="line">    <span class="keyword">if</span> cursor.execute(sql,tuple(data.values()) * <span class="number">2</span>):</span><br><span class="line">        print(<span class="string">'successful'</span>)</span><br><span class="line">        db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">'failed'</span>)</span><br><span class="line">    db.rollback()</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    db.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">table = <span class="string">'students'</span></span><br><span class="line">condition = <span class="string">'age &gt; 20'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 因为删除条件有多种多样，所以不再继续构造复杂的判断性。这里之间将条件当做字符串来传递，以实现删除操作</span></span><br><span class="line">sql = <span class="string">'DELETE FROM &#123;table&#125; WHERE &#123;condition&#125;'</span>.format(table=table,condition=condition)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.excute(sql)</span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    db.rollback()</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    db.close</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>, user=<span class="string">'root'</span>, password=<span class="string">''</span>, port=<span class="number">3306</span>, db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">sql = <span class="string">'SELECT * FROM students WHERE age &gt;= 19'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    print(<span class="string">'Count:'</span>,cursor.rowcount)</span><br><span class="line">    <span class="comment"># 内部有一个偏移指针用来指向查询结果，最开始偏移指针指向第一条数据，取一次以后，指针指向下一条数	   据，这样再取得话，就会取到下一条数据</span></span><br><span class="line">    <span class="comment"># one = cursor.fetchone()</span></span><br><span class="line">    <span class="comment"># print('One:',one)</span></span><br><span class="line">    result = cursor.fetchall()</span><br><span class="line">    print(<span class="string">'Result:'</span>,result)</span><br><span class="line">    print(<span class="string">'Result Type:'</span>,type(result))</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> result:</span><br><span class="line">        print(row)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"Error"</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    db.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果：</span></span><br><span class="line">Count: <span class="number">2</span></span><br><span class="line">One: (<span class="string">'20120001'</span>, <span class="string">'bob'</span>, <span class="number">25</span>)</span><br><span class="line">Result: ((<span class="string">'20120002'</span>, <span class="string">'bob'</span>, <span class="number">20</span>),)</span><br><span class="line">Result Type: &lt;<span class="class"><span class="keyword">class</span> '<span class="title">tuple</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="params">(<span class="string">'20120002'</span>, <span class="string">'bob'</span>, <span class="number">20</span>)</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="非关系型存储"><a href="#非关系型存储" class="headerlink" title="非关系型存储"></a>非关系型存储</h3><blockquote>
<p>NoSQL，全称Not Only SQL，意为不仅仅是SQL，泛指非关系型数据库。NoSQL是基于键值对的，而且不需要经过SQL层的解析，数据之间没有耦合性，性能非常高。</p>
</blockquote>
<ul>
<li>分类<ul>
<li>键值存储数据库：Redis、Voldemort和Oracle BDB等</li>
<li>列存储数据库：Cassandra、HBase和Riak等</li>
<li>文档型数据库：CouchDB和MongoDB等</li>
<li>图形数据库：Neo4J、InfoGrid和Infinite Graph等</li>
</ul>
</li>
</ul>
<h4 id="MongoDB存储"><a href="#MongoDB存储" class="headerlink" title="MongoDB存储"></a>MongoDB存储</h4><ul>
<li><p>连接MongoDB，连接数据库并插入、查询数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接数据库</span></span><br><span class="line">client = MongoClient(<span class="string">'mongodb://localhost:27017/'</span>)</span><br><span class="line"><span class="comment"># client = pymongo.MongoClient(host='localhost',prot=27017)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定数据库，两种方式等价</span></span><br><span class="line"><span class="comment"># db = client.test</span></span><br><span class="line">db = client[<span class="string">'test'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定集合</span></span><br><span class="line"><span class="comment"># collection = db.student</span></span><br><span class="line">collection = db[<span class="string">'student'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入数据</span></span><br><span class="line">student = &#123;</span><br><span class="line">    <span class="string">'id'</span>:<span class="string">'20170101'</span>,</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'jordan'</span>,</span><br><span class="line">    <span class="string">'age'</span>:<span class="number">20</span>,</span><br><span class="line">    <span class="string">'gender'</span>:<span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">student1 = &#123;</span><br><span class="line">    <span class="string">'id'</span>:<span class="string">'20170102'</span>,</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'mike'</span>,</span><br><span class="line">    <span class="string">'age'</span>:<span class="number">20</span>,</span><br><span class="line">    <span class="string">'gender'</span>:<span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">student2 = &#123;</span><br><span class="line">    <span class="string">'id'</span>:<span class="string">'20170103'</span>,</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'du'</span>,</span><br><span class="line">    <span class="string">'age'</span>:<span class="number">20</span>,</span><br><span class="line">    <span class="string">'gender'</span>:<span class="string">'male'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入一条数据并返回_id值</span></span><br><span class="line"><span class="comment"># result = collection.insert_one(student)</span></span><br><span class="line"><span class="comment"># print(result.inserted_id)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入多条数据</span></span><br><span class="line"><span class="comment"># result = collection.insert_many([student1,student2])</span></span><br><span class="line"><span class="comment"># print(result.inserted_ids)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询数据 利用find_one()或find()方法进行查询</span></span><br><span class="line">result = collection.find_one(&#123;<span class="string">'name'</span>:<span class="string">'mike'</span>&#125;)</span><br><span class="line">print(type(result))</span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line">results = collection.find(&#123;<span class="string">'age'</span>:<span class="number">20</span>&#125;)</span><br><span class="line">print(results)</span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">    print(r)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询年龄大于20的数据</span></span><br><span class="line">results = collection.find(&#123;<span class="string">'age'</span>:&#123;<span class="string">'$gt'</span>:<span class="number">19</span>&#125;&#125;)</span><br><span class="line">print(results)</span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">    print(r)</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询符号表</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fteyfoplygj30ml06ngmq.jpg" alt="img"></p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fteyjn2frlj30ml06eq4b.jpg" alt="img"></p>
</li>
<li><p>计数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">count = collection.find().count()</span><br><span class="line">print(count)</span><br><span class="line"></span><br><span class="line">count = collection.find(&#123;<span class="string">'age'</span>:<span class="number">20</span>&#125;).count()</span><br><span class="line">print(count)</span><br></pre></td></tr></table></figure>
</li>
<li><p>排序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 升序：pymongo.ASCENDING 降序：pymongo.DESCENDING</span></span><br><span class="line">results = collection.find.sort(<span class="string">'name'</span>,pymongo.ASCENDING)</span><br><span class="line">print([result[<span class="string">'name'</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results])</span><br></pre></td></tr></table></figure>
</li>
<li><p>偏移</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 忽略前两个元素</span></span><br><span class="line">results = collection.find().sort(<span class="string">'name'</span>,pymongo.ASCENDING).skip(<span class="number">2</span>)</span><br><span class="line">print([result[<span class="string">'name'</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 忽略前两个元素并只取2个元素结果</span></span><br><span class="line">results = collection.find().sort(<span class="string">'name'</span>,pymongo.ASCENDING).skip(<span class="number">2</span>).limit(<span class="number">2</span>)</span><br><span class="line">print([result[<span class="string">'name'</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results])</span><br></pre></td></tr></table></figure>
</li>
<li><p>更新</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新数据</span></span><br><span class="line">condition = &#123;<span class="string">'name'</span>:<span class="string">'du'</span>&#125;</span><br><span class="line">student = collection.find_one(condition)</span><br><span class="line">student[<span class="string">'age'</span>] = <span class="number">25</span></span><br><span class="line"><span class="comment"># 建议使用update_one或update_many</span></span><br><span class="line"><span class="comment"># result = collection.update(condition,student)</span></span><br><span class="line"><span class="comment"># 也可以使用$set操作符对数据进行更新，这样可以只更新student字典内存在的字段，如果原先还有其他字段，则不会更新也不会删除。</span></span><br><span class="line"><span class="comment"># result = collection.update(condition,&#123;'$set':student&#125;)</span></span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line">condition = &#123;<span class="string">'name'</span>:<span class="string">'mike'</span>&#125;</span><br><span class="line">student = collection.find_one(condition)</span><br><span class="line">student[<span class="string">'age'</span>] = <span class="number">26</span></span><br><span class="line">result = collection.update_one(condition,&#123;<span class="string">'$set'</span>:student&#125;)</span><br><span class="line">print(result)</span><br><span class="line">print(result.matched_count,result.modified_count)</span><br><span class="line"></span><br><span class="line">condition = &#123;<span class="string">'age'</span>:&#123;<span class="string">'$gt'</span>:<span class="number">20</span>&#125;&#125;</span><br><span class="line"><span class="comment"># 第一条符合条件的年龄+1</span></span><br><span class="line"><span class="comment"># result = collection.update_one(condition,&#123;'$inc':&#123;'age':1&#125;&#125;)</span></span><br><span class="line">result = collection.update_many(condition,&#123;<span class="string">'$inc'</span>:&#123;<span class="string">'age'</span>:<span class="number">1</span>&#125;&#125;)</span><br><span class="line">print(result)</span><br><span class="line">print(result.matched_count,result.modified_count)</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除</span></span><br><span class="line">result = collection.delete_one(&#123;<span class="string">'name'</span>:<span class="string">'mike'</span>&#125;)</span><br><span class="line">print(result)</span><br><span class="line">print(result.deleted_count)</span><br><span class="line">result = collection.delete_many(&#123;<span class="string">'age'</span>:<span class="number">20</span>&#125;)</span><br><span class="line">print(result)</span><br><span class="line">print(result.deleted_count)</span><br></pre></td></tr></table></figure>
</li>
<li><p>其他方法</p>
<ul>
<li>find_one_and_delete()、finde_one_and_replace()和find_one_and_update()等</li>
<li>create_index()、create_indexes()和drop_index()等</li>
<li>操作指南：<a href="https://docs.mongodb.com/guides/" target="_blank" rel="noopener">https://docs.mongodb.com/guides/</a></li>
<li>PyMongo官方文档：<a href="http://api.mongodb.com/python/current/api/pymongo/collection.html" target="_blank" rel="noopener">http://api.mongodb.com/python/current/api/pymongo/collection.html</a></li>
</ul>
</li>
</ul>
<h4 id="Redis存储"><a href="#Redis存储" class="headerlink" title="Redis存储"></a>Redis存储</h4><blockquote>
<p>Redis是一个基于内存的高效的键值型非关系型数据库，存取效率极高，而且支持多种存储数据结构，使用简单。</p>
</blockquote>
<ul>
<li><p>启动redis服务端</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动redis数据库服务端</span></span><br><span class="line">redis-server</span><br><span class="line"><span class="comment"># 使用密码启动redis客户端</span></span><br><span class="line">redis-cli -a 1234</span><br></pre></td></tr></table></figure>
</li>
<li><p>Redis和StrictRedis</p>
<p>redis-py库提供两个类Redis和StrictRedis来实现Redis的命令操作（官方推荐使用StrictRedis）</p>
</li>
<li><p>连接Redis</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> StrictRedis,ConnectionPool</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用ConnectionPool连接</span></span><br><span class="line">pool = ConnectionPool(host=<span class="string">'localhost'</span>,port=<span class="number">6379</span>,db=<span class="number">0</span>,password=<span class="string">'1234'</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">''''</span></span><br><span class="line"><span class="string"># ConnectionPool还支持通过URL来构建</span></span><br><span class="line"><span class="string"># Redis TCP连接</span></span><br><span class="line"><span class="string">redis://[:passwrod]@host:port/db</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Redis TCP+SSL连接</span></span><br><span class="line"><span class="string">rediss://[:passwrod]@host:port/db</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Reids UNIX socket连接</span></span><br><span class="line"><span class="string">unix://[:password]@path/to/socket.sock?db=db</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">url = 'redis://:1234@localhost:6379/0'</span></span><br><span class="line"><span class="string">pool = ConnectionPoo;.from_url(url)</span></span><br><span class="line"><span class="string">redis = StrictRedis(connection_pool=pool)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># redis = StrictRedis(host='localhost',port=6379,db=0,password='1234')</span></span><br><span class="line"></span><br><span class="line">redis = StrictRedis(connection_pool=pool)</span><br><span class="line">redis.set(<span class="string">'name'</span>,<span class="string">'duzhida'</span>)</span><br><span class="line">print(redis.get(<span class="string">'name'</span>))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="六、Ajax数据爬取"><a href="#六、Ajax数据爬取" class="headerlink" title="六、Ajax数据爬取"></a>六、Ajax数据爬取</h2><h3 id="6-1-什么是Ajax"><a href="#6-1-什么是Ajax" class="headerlink" title="6.1 什么是Ajax"></a>6.1 什么是Ajax</h3><h3 id="什么是Ajax"><a href="#什么是Ajax" class="headerlink" title="什么是Ajax"></a>什么是Ajax</h3><blockquote>
<p>Ajax全称为Asynchronous JavaScript and XML，即异步的JavaScript和XML。它不是一门编程语言，而是利用JavaScript在保证页面不被刷新，页面链接不改变的情况下与服务器交换数据并更新部分网页的的技术。</p>
</blockquote>
<h4 id="基本原理-1"><a href="#基本原理-1" class="headerlink" title="基本原理"></a>基本原理</h4><ul>
<li><p>实例引入：很多网页都有下滑查看更多的选项，下滑页面会出现加载动画，一段时间过后才会出现新的内容，这个过程就是Ajax加载的过程。</p>
</li>
<li><p>发送Ajax请求到网页更新的过程分为以下3步：</p>
<ol>
<li>发送请求</li>
<li>解析内容</li>
<li>渲染网页</li>
</ol>
</li>
<li><p>发送请求</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个JavaScript对Ajax最底层的实现，实际上就是新建了XMLHttpReequest对象，然后调用onreadystatechange属性设置了监听，然后调用open()和send()方法向某个链接(服务器)发送请求</span></span><br><span class="line"><span class="keyword">var</span> xmlhttp;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">window</span>.XMLHttpRequest)&#123;</span><br><span class="line">    <span class="comment">//code for IE7+,Firfox,Chrome,Opera,Safari</span></span><br><span class="line">    xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//code for IE6,IE5</span></span><br><span class="line">    xmlhttp = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(xmlhttp.readyState == <span class="number">4</span> &amp;&amp; xmlhttp.status == <span class="number">200</span>)&#123;</span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">"myDiv"</span>).innerHTML = xmlhttp.responseText;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.open(<span class="string">"POST"</span>,<span class="string">"/ajax/"</span>,<span class="literal">true</span>);</span><br><span class="line">xmlhttp.send()</span><br></pre></td></tr></table></figure>
</li>
<li><p>解析内容</p>
<p>得到相应之后，onreadystatechange属性对应的方法就会触发，此时利用xmlhttp的responseText属性便可取到响应内容。返回的内容可能是HTML，可能是JSON，接下来只需要在方法中用JavaScript进一步处理即可。</p>
</li>
<li><p>渲染网页</p>
<p>JavaScript有改变网页内容的能力，解析完响应内容之后，就可以调用JavaScript来针对解析完的内容对网页进行下一步处理。比如，通过document。getElementById().innerHTML就可以对元素内的源代码进行更改。这样网页显示的内容就改变了，这样的操作也被称为DOM操作。</p>
</li>
</ul>
<h3 id="6-2-Ajax分析方法"><a href="#6-2-Ajax分析方法" class="headerlink" title="6.2 Ajax分析方法"></a>6.2 Ajax分析方法</h3><ol>
<li><p>查看请求</p>
<p><img src="/var/folders/g_/cckjvp_d1b39h60g3s9grbp00000gn/T/abnerworks.Typora/image.tiff" alt="img"></p>
<p><img src="/var/folders/g_/cckjvp_d1b39h60g3s9grbp00000gn/T/abnerworks.Typora/image-20180810214920108.tiff" alt="img"></p>
<p>XHR即是Ajax特殊的请求类型。</p>
</li>
<li><p>过滤请求</p>
<p><img src="https://ws4.sinaimg.cn/large/0069RVTdgy1fu4y2uiikhj31kw0v5174.jpg" alt="img"></p>
</li>
</ol>
<h3 id="6-3-Ajax结果提取"><a href="#6-3-Ajax结果提取" class="headerlink" title="6.3 Ajax结果提取"></a>6.3 Ajax结果提取</h3><ul>
<li>分析请求</li>
</ul>
<h3 id="6-4-分析Ajax爬取今日头条街拍美图"><a href="#6-4-分析Ajax爬取今日头条街拍美图" class="headerlink" title="6.4 分析Ajax爬取今日头条街拍美图"></a>6.4 分析Ajax爬取今日头条街拍美图</h3><ul>
<li><p>抓取分析</p>
<ul>
<li>目标：<a href="https://www.toutiao.com/search/?keyword=%E8%A1%97%E6%8B%8D" target="_blank" rel="noopener">https://www.toutiao.com/search/?keyword=%E8%A1%97%E6%8B%8D</a></li>
</ul>
</li>
<li><p>实战演练</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlencode</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> RequestException</span><br><span class="line"><span class="keyword">from</span> spider_toutiao.config <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">流程框架：</span></span><br><span class="line"><span class="string">1. 抓取索引页内容</span></span><br><span class="line"><span class="string">  利用requests请求目标站点，得到索引网页HTML代码，返回结果</span></span><br><span class="line"><span class="string">2. 抓取详情页内容</span></span><br><span class="line"><span class="string">  解析返回结果，得到详情页的链接，并进一步抓取详情页的信息</span></span><br><span class="line"><span class="string">3. 下载图片与保存数据库</span></span><br><span class="line"><span class="string">  将图片下载到本地，并把页面信息及图片URL保存至MongoDB</span></span><br><span class="line"><span class="string">4. 开启循环及多线程</span></span><br><span class="line"><span class="string">  对多页内容遍历，开启多线程提高抓取速度</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_page_index</span><span class="params">(offset,keyword)</span>:</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">'offset'</span>: offset,</span><br><span class="line">        <span class="string">'format'</span>: <span class="string">'json'</span>,</span><br><span class="line">        <span class="string">'keyword'</span>: keyword,</span><br><span class="line">        <span class="string">'autoload'</span>: <span class="string">'true'</span>,</span><br><span class="line">        <span class="string">'count'</span>: <span class="string">'20'</span>,</span><br><span class="line">        <span class="string">'cur_tab'</span>: <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">    url = <span class="string">'https://www.toutiao.com/search_content/?'</span> + urlencode(data)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        print(<span class="string">'请求索引页错误'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_page_index</span><span class="params">(html)</span>:</span></span><br><span class="line">    data = json.loads(html)</span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">and</span> <span class="string">'data'</span> <span class="keyword">in</span> data.keys():</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> data.get(<span class="string">'data'</span>):</span><br><span class="line">            <span class="keyword">yield</span> item.get(<span class="string">'article_url'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_page_detail</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36'</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.get(url,headers=headers)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        print(<span class="string">'请求详情页页错误'</span>, url)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_page_detail</span><span class="params">(html,url)</span>:</span></span><br><span class="line">    soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">    title = soup.select(<span class="string">"title"</span>)[<span class="number">0</span>].get_text()</span><br><span class="line">    images_pattern = re.compile(<span class="string">'gallery: JSON.parse\((.*?)\),'</span>,re.S)</span><br><span class="line">    results = re.search(images_pattern,html)</span><br><span class="line">    <span class="keyword">if</span> results:</span><br><span class="line">        data = json.loads(json.loads(results.group(<span class="number">1</span>)))</span><br><span class="line">        <span class="keyword">if</span> data <span class="keyword">and</span> <span class="string">'sub_images'</span> <span class="keyword">in</span> data.keys():</span><br><span class="line">            sub_images = data.get(<span class="string">'sub_images'</span>)</span><br><span class="line">            images = [item.get(<span class="string">'url'</span>) <span class="keyword">for</span> item <span class="keyword">in</span> sub_images]</span><br><span class="line">            <span class="keyword">for</span> image <span class="keyword">in</span> images:</span><br><span class="line">                download_image(image,title)</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">'title'</span>: title,</span><br><span class="line">                <span class="string">'url'</span>: url,</span><br><span class="line">                <span class="string">'images'</span>: images</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download_image</span><span class="params">(url, title)</span>:</span></span><br><span class="line">    print(<span class="string">"正在下载："</span> + title)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            save_image(response.content,title)</span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        print(<span class="string">'请求图片出错'</span>, url)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_image</span><span class="params">(content, title)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(title):</span><br><span class="line">        os.mkdir(title)</span><br><span class="line">    file_path = <span class="string">'&#123;0&#125;/&#123;1&#125;.&#123;2&#125;'</span>.format(title,md5(content).hexdigest(),<span class="string">'jpg'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(file_path):</span><br><span class="line">        <span class="keyword">with</span> open(file_path,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(content)</span><br><span class="line">            f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(OFFSET):</span><br><span class="line">        html = get_page_index(<span class="number">20</span> * i,KEYWORD + <span class="string">'图集'</span>)</span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> parse_page_index(html):</span><br><span class="line">            html = get_page_detail(url)</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> html:</span><br><span class="line">                parse_page_detail(html,url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># groups = [x * 20 for x in range(GROUP_START,GROUP_END + 1)]</span></span><br><span class="line">    <span class="comment"># pool = Pool()</span></span><br><span class="line">    <span class="comment"># pool.map(main, groups)</span></span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Ajax分析方法"><a href="#Ajax分析方法" class="headerlink" title="Ajax分析方法"></a>Ajax分析方法</h3><ol>
<li>查看请求</li>
<li>过滤请求</li>
</ol>
<h2 id="七、动态渲染页面爬取"><a href="#七、动态渲染页面爬取" class="headerlink" title="七、动态渲染页面爬取"></a>七、动态渲染页面爬取</h2><h3 id="7-1-Selenium的使用"><a href="#7-1-Selenium的使用" class="headerlink" title="7.1 Selenium的使用"></a>7.1 Selenium的使用</h3><blockquote>
<p>Selenium是一个自动化测试工具，利用它可以驱动浏览器执行特定的动作，如点击、下拉等操作，同时还可以获取浏览器当前呈现的页面的源代码，做到可见既可爬。</p>
</blockquote>
<ul>
<li><p>安装selenium</p>
<p><code>pip install selenium</code></p>
<ul>
<li><p>安装chromedriver</p>
<ul>
<li><p><a href="http://chromedriver.chromium.org/downloads" target="_blank" rel="noopener">下载地址</a></p>
</li>
<li><p>解压并移动到python安装目录下<code>sudo mv chromedriver /usr/bin</code></p>
</li>
<li><p>配置ChromeDriver到$PATH</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="string">"<span class="variable">$PATH</span>:/usr/local/chromedriver"</span></span><br><span class="line"><span class="built_in">source</span> ~/.profile</span><br></pre></td></tr></table></figure>
</li>
<li><p>输出<code>Only local connections are allowed</code>则配置完成</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>基本使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"></span><br><span class="line">brower = webdriver.Chrome()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    brower.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">    input = brower.find_element_by_id(<span class="string">'kw'</span>)</span><br><span class="line">    input.send_keys(<span class="string">'Python'</span>)</span><br><span class="line">    input.send_keys(Keys.ENTER)</span><br><span class="line">    wait = WebDriverWait(brower,<span class="number">1000</span>)</span><br><span class="line">    wait.until(EC.presence_of_element_located((By.ID,<span class="string">'content_left'</span>)))</span><br><span class="line">    print(brower.current_url)</span><br><span class="line">    <span class="comment"># print(brower.get_cookies())</span></span><br><span class="line">    <span class="comment"># print(brower.page_source)</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    brower.close()</span><br></pre></td></tr></table></figure>
<ul>
<li><p>声明浏览器支持对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser = webdriver.Firefox()</span><br><span class="line">browser = webdriver.Edge()</span><br><span class="line">browser = webdriver.PhantomJS()</span><br><span class="line">browser = webdriver.Safari()</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问页面</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">print(browser.page_source)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>查找节点</p>
<ul>
<li><p>单个节点，可以根据name、id获取，还可以根据XPath、CSS选择器等获取的方式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">input_first = browser.find_element_by_id(<span class="string">'q'</span>)</span><br><span class="line">input_second = browser.find_element_by_css_selector(<span class="string">'#q'</span>)</span><br><span class="line">input_third = browser.find_element_by_xpath(<span class="string">'//*[@id="q"]'</span>)</span><br><span class="line">print(input_first,input_second,input_third)</span><br><span class="line">browser.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所有获取单个节点的方法</span></span><br><span class="line">browser.find_element_by_id()</span><br><span class="line">browser.find_element_by_name()</span><br><span class="line">browser.find_element_by_xpath()</span><br><span class="line">browser.find_element_by_link_text()</span><br><span class="line">browser.find_element_by_tag_name()</span><br><span class="line">browser.find_element_by_class_name()</span><br><span class="line">browser.find_element_by_css_selector()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通用方法</span></span><br><span class="line">browser.find_element(By.ID,id)</span><br></pre></td></tr></table></figure>
</li>
<li><p>多个节点</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">lis = browser.find_elements_by_css_selector(<span class="string">'.service-bd li'</span>)</span><br><span class="line">print(lis)</span><br><span class="line">browser.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 所有获取多个节点的方法</span></span><br><span class="line">browser.find_elements_by_id()</span><br><span class="line">browser.find_elements_by_name()</span><br><span class="line">browser.find_elements_by_xpath()</span><br><span class="line">browser.find_elements_by_link_text()</span><br><span class="line">browser.find_elements_by_partial_link_text()</span><br><span class="line">browser.find_elements_by_tag_name()</span><br><span class="line">browser.find_elements_by_class_name()</span><br><span class="line">browser.find_elements_by_css_selector()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通用方法</span></span><br><span class="line">browser.find_elements(By.ID,id)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>节点交互</p>
<ul>
<li>常见用法有：输入文字send_keys()方法，清空文字clear()方法，点击按钮click()方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">input = browser.find_element_by_id(<span class="string">'q'</span>)</span><br><span class="line">input.send_keys(<span class="string">'iPhone'</span>)</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">input.clear()</span><br><span class="line">input.send_keys(<span class="string">'ipad'</span>)</span><br><span class="line">button = browser.find_element_by_class_name(<span class="string">'btn-search'</span>)</span><br><span class="line">button.click()</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.remote.webelement" target="_blank" rel="noopener">官方文档</a></p>
</blockquote>
</li>
<li><p>动作链</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'http://www.runoob.com/try/try.php?filename=jqueryui-example-droppable'</span></span><br><span class="line">browser.get(url)</span><br><span class="line">browser.switch_to.frame(<span class="string">'iframeResult'</span>)</span><br><span class="line">source = browser.find_element_by_css_selector(<span class="string">'#draggable'</span>)</span><br><span class="line">target = browser.find_element_by_css_selector(<span class="string">'#droppable'</span>)</span><br><span class="line">actions = ActionChains(browser)</span><br><span class="line">actions.drag_and_drop(source,target)</span><br><span class="line">actions.perform()</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行JavaScript</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</span><br><span class="line">browser.execute_script(<span class="string">'window.scrollTo(0,document.body.scrollHeight)'</span>)</span><br><span class="line">browser.execute_script(<span class="string">'alert("To Bottom")'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取节点信息</p>
<ul>
<li><p>获取属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'https://www.zhihu.com/explore'</span></span><br><span class="line">browser.get(url)</span><br><span class="line">logo = browser.find_element_by_id(<span class="string">'zh-top-link-logo'</span>)</span><br><span class="line">print(logo)</span><br><span class="line">print(logo.get_attribute(<span class="string">'class'</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取文本值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'https://www.zhihu.com/explore'</span></span><br><span class="line">browser.get(url)</span><br><span class="line">input = browser.find_element_by_class_name(<span class="string">'js-signin-noauth'</span>)</span><br><span class="line">print(input.text)</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取id、位置、标签名和大小</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'https://www.zhihu.com/explore'</span></span><br><span class="line">browser.get(url)</span><br><span class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</span><br><span class="line">print(input.id)</span><br><span class="line">print(input.location)</span><br><span class="line">print(input.tag_name)</span><br><span class="line">print(input.size)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>切换Frame</p>
<p>网页中有一种节点叫作iframe，它的结构和外部网页的结构完全一致。Selenium打开网页后，它默认实在父级Frame里面操作，如果页面中还有子Frame，它是不能获取到子Frame里面的节点的，需要使用switch_to.frame()方法来切换Frame。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> NoSuchElementException</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span></span><br><span class="line">browser.get(url)</span><br><span class="line">browser.switch_to.frame(<span class="string">'iframeResult'</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    logo = browser.find_element_by_class_name(<span class="string">'logo'</span>)</span><br><span class="line"><span class="keyword">except</span> NoSuchElementException:</span><br><span class="line">    print(<span class="string">'no logo'</span>)</span><br><span class="line">browser.switch_to.parent_frame()</span><br><span class="line">logo = browser.find_element_by_class_name(<span class="string">'logo'</span>)</span><br><span class="line">print(logo)</span><br><span class="line">print(logo.text)</span><br></pre></td></tr></table></figure>
</li>
<li><p>延时等待</p>
<p>在Selenium中，get()方法会在网页框架加载结束后结束执行，但可能并不是浏览器完全加载完成的页面，所以需要延时等待一定时间，确保节点已经加载出来。</p>
<ul>
<li><p>隐式等待</p>
<p>使用隐式等待执行测试的时候，如果Selenium没有在DOM中找到节点，将继续等待，超出设定时间则抛出找不到节点的异常，默认时间为0。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">option = webdriver.ChromeOptions()</span><br><span class="line">option.add_argument(<span class="string">'-headless'</span>)</span><br><span class="line">browser = webdriver.Chrome(options=option)</span><br><span class="line">browser.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</span><br><span class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</span><br><span class="line">print(input)</span><br></pre></td></tr></table></figure>
</li>
<li><p>显式等待</p>
<p>显式等待指定要查找的节点，然后指定一个最长等待时间。如果在规定时间内加载出该节点，就返回查找的节点；如果未加载出该节点，则抛出异常。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line">option = webdriver.ChromeOptions()</span><br><span class="line">option.add_argument(<span class="string">'-headless'</span>)</span><br><span class="line">browser = webdriver.Chrome(options=option)</span><br><span class="line"><span class="comment"># browser = webdriver.Chrome()</span></span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com/'</span>)</span><br><span class="line">wait = WebDriverWait(browser,<span class="number">10</span>)</span><br><span class="line"><span class="comment"># presence_of_element_located的参数是节点的定位元祖，也就是ID为q的节点搜索框</span></span><br><span class="line">input = wait.until(EC.presence_of_element_located((By.ID,<span class="string">'q'</span>)))</span><br><span class="line">button = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR,<span class="string">'.btn-search'</span>)))</span><br><span class="line">print(input,button)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>其他等待条件</p>
<p>| 等待条件                               | 含义                                            |<br>| ————————————– | ———————————————– |<br>| title_is                               | 标题是某内容                                    |<br>| title_contains                         | 标题包含某内容                                  |<br>| presence_of_element_located            | 节点加载出来，传入定位元祖                      |<br>| visibility_of+element_located          | 节点可见，传入定位元祖                          |<br>| visibility_of                          | 可见，传入节点对象                              |<br>| presence_of_all_elements_located       | 所有节点加载出来                                |<br>| text_to_be_present_in_element          | 某个节点文本包含某文字                          |<br>| text_to_bo_present_in_element_value    | 某个节点值包含某文字                            |<br>| frame_to_bo_available_and_switch_to_it | 加载并切换                                      |<br>| invisibility_of_element_located        | 节点不可见                                      |<br>| element_to_be_clickable                | 节点可点击                                      |<br>| staleness_of                           | 判断一个节点是否仍在DOM，可判断页面是否已经刷新 |<br>| element_to_be_selected                 | 节点可选择，传入节点对象                        |<br>| element_located_to_be_selected         | 节点可选择，传入定位元祖                        |<br>| element_selection_state_to_be          | 传入节点对象及状态，相等为True，否则False       |<br>| element_located_selection_state_to_be  | 传入定位元祖及状态，相等为True，否则False       |<br>| alert_is_present                       | 是否出现警告                                    |</p>
<blockquote>
<p><a href="http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.support.expected_conditions" target="_blank" rel="noopener">更多参考官方文档</a></p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
<li><p>前进和后退</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">browser.back()</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">browser.forward()</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>Cookies</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">option = webdriver.ChromeOptions()</span><br><span class="line">option.add_argument(<span class="string">'-headless'</span>)</span><br><span class="line">browser = webdriver.Chrome(options=option)</span><br><span class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</span><br><span class="line">print(browser.get_cookies())</span><br><span class="line">browser.add_cookie(&#123;<span class="string">'name'</span>:<span class="string">'name'</span>,<span class="string">'domain'</span>:<span class="string">'www.zhihu.com'</span>,<span class="string">'value'</span>:<span class="string">'germey'</span>&#125;)</span><br><span class="line">print(<span class="string">'-'</span> * <span class="number">50</span>)</span><br><span class="line">print(browser.get_cookies())</span><br><span class="line">browser.delete_all_cookies()</span><br><span class="line">print(browser.get_cookies())</span><br></pre></td></tr></table></figure>
</li>
<li><p>选项卡管理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">browser.execute_script(<span class="string">'window.open()'</span>)</span><br><span class="line">print(browser.window_handles)</span><br><span class="line">browser.switch_to_window(browser.window_handles[<span class="number">1</span>])</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">browser.switch_to_window(browser.window_handles[<span class="number">0</span>])</span><br><span class="line">browser.get(<span class="string">'https://www.python.org'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>异常处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException,NoSuchElementException</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"><span class="keyword">except</span> TimeoutException:</span><br><span class="line">    print(<span class="string">'time out'</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    browser.find_element_by_id(<span class="string">'hello'</span>)</span><br><span class="line"><span class="keyword">except</span> NoSuchElementException:</span><br><span class="line">    print(<span class="string">'no element'</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    browser.close()</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="7-2-Splash的使用"><a href="#7-2-Splash的使用" class="headerlink" title="7.2 Splash的使用"></a>7.2 Splash的使用</h3><ul>
<li>功能<ul>
<li>异步方式处理多个网页渲染过程</li>
<li>获取渲染后的页面的源代码或截图</li>
<li>通过关闭图片渲染或使用adblock规则来加快页面渲染速度</li>
<li>可执行特定的JavaScript脚本</li>
<li>可通过Lua脚本来控制页面渲染速度</li>
<li>获取渲染的详细过程病通过HAR格式呈现</li>
</ul>
</li>
<li>安装<ul>
<li>安装docker<code>brew cask install docker</code></li>
<li>现在安装spalsh<code>docker pull scrapinghub/splash</code></li>
<li>运行spalsh<code>docker run -p 8050:8050 -p 5023:5023 scrapinghub/splash</code></li>
<li>使用浏览器访问<code>http://localhost:8050</code></li>
</ul>
</li>
<li></li>
</ul>
<h3 id="7-3-Splash负载均衡配置"><a href="#7-3-Splash负载均衡配置" class="headerlink" title="7.3 Splash负载均衡配置"></a>7.3 Splash负载均衡配置</h3><h3 id="7-4-使用Selenium爬取淘宝商品"><a href="#7-4-使用Selenium爬取淘宝商品" class="headerlink" title="7.4 使用Selenium爬取淘宝商品"></a>7.4 使用Selenium爬取淘宝商品</h3><blockquote>
<p>使用Selenium模拟浏览器操作，抓取淘宝的商品信息，并将结果保存到MongoDB</p>
</blockquote>
<p>目标地址：<a href="https://s.taobao.com/search?q=美食" target="_blank" rel="noopener">https://s.taobao.com/search?q=美食</a></p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwgy1fvm5on4s0lj311h0opqv5.jpg" alt="meishi"></p>
<p>步骤：</p>
<ol>
<li><p>搜索关键词</p>
<p>利用Selenium驱动浏览器搜索关键词，得到查询后的商品列表</p>
</li>
<li><p>分析页码并翻页</p>
<p>得到商品页码数，模拟翻页，得到后续页面的商品列表</p>
</li>
<li><p>分析提取商品内容</p>
<p>利用PyQuery分析源码，解析得到商品列表</p>
</li>
<li><p>存储至mongoDB</p>
<p>将商品列表存储至数据库MongoDB</p>
</li>
</ol>
<p>代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">MONGO_URL = <span class="string">'localhost'</span></span><br><span class="line">MONGO_DB = <span class="string">'taobao'</span></span><br><span class="line">MONGO_TABLE = <span class="string">'product'</span></span><br><span class="line">client = pymongo.MongoClient(MONGO_URL)</span><br><span class="line">db = client[MONGO_DB]</span><br><span class="line">option = webdriver.ChromeOptions()</span><br><span class="line">option.add_argument(<span class="string">'-headless'</span>)</span><br><span class="line">browser = webdriver.Chrome(options=option)</span><br><span class="line"><span class="comment"># browser = webdriver.Chrome()</span></span><br><span class="line">wait = WebDriverWait(browser, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">        input = wait.until(</span><br><span class="line">            EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">"#q"</span>))</span><br><span class="line">        )</span><br><span class="line">        submit = wait.until(</span><br><span class="line">            EC.element_to_be_clickable((By.CSS_SELECTOR, <span class="string">"#J_TSearchForm &gt; div.search-button &gt; button"</span>))</span><br><span class="line">        )</span><br><span class="line">        input.send_keys(<span class="string">'美食'</span>)</span><br><span class="line">        submit.click()</span><br><span class="line">        total = wait.until(EC.presence_of_element_located((By.CSS_SELECTOR,<span class="string">'#mainsrp-pager &gt; div &gt; div &gt; div &gt; div.total'</span>)))</span><br><span class="line">        get_products()</span><br><span class="line">        <span class="keyword">return</span> total.text</span><br><span class="line">    <span class="keyword">except</span> TimeoutException:</span><br><span class="line">        <span class="keyword">return</span> search()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">next_page</span><span class="params">(page_number)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        input = wait.until(</span><br><span class="line">            EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">"#mainsrp-pager &gt; div &gt; div &gt; div &gt; div.form &gt; input"</span>))</span><br><span class="line">        )</span><br><span class="line">        submit = wait.until(</span><br><span class="line">            EC.element_to_be_clickable((By.CSS_SELECTOR, <span class="string">"#mainsrp-pager &gt; div &gt; div &gt; div &gt; div.form &gt; span.btn.J_Submit"</span>))</span><br><span class="line">        )</span><br><span class="line">        input.clear()</span><br><span class="line">        input.send_keys(page_number)</span><br><span class="line">        submit.click()</span><br><span class="line">        wait.until(EC.text_to_be_present_in_element((By.CSS_SELECTOR,<span class="string">'#mainsrp-pager &gt; div &gt; div &gt; div &gt; ul &gt; li.item.active &gt; span'</span>),str(page_number)))</span><br><span class="line">        get_products()</span><br><span class="line">    <span class="keyword">except</span> TimeoutException:</span><br><span class="line">        next_page(page_number)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_products</span><span class="params">()</span>:</span></span><br><span class="line">    wait.until(EC.presence_of_element_located((By.CSS_SELECTOR,<span class="string">'#mainsrp-itemlist .items .item'</span>)))</span><br><span class="line">    html = browser.page_source</span><br><span class="line">    doc = pq(html)</span><br><span class="line">    items = doc(<span class="string">'#mainsrp-itemlist .items .item'</span>).items()</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        product = &#123;</span><br><span class="line">            <span class="string">'title'</span>: item.find(<span class="string">'.title'</span>).text(),</span><br><span class="line">            <span class="string">'price'</span>: item.find(<span class="string">'.price'</span>).text(),</span><br><span class="line">            <span class="string">'location'</span>: item.find(<span class="string">'.location'</span>).text(),</span><br><span class="line">            <span class="string">'image'</span>: item.find(<span class="string">'.pic .img'</span>).attr(<span class="string">'data-src'</span>),</span><br><span class="line">            <span class="string">'deal'</span>: item.find(<span class="string">'.deal-cnt'</span>).text()[:<span class="number">-3</span>],</span><br><span class="line">            <span class="string">'shop'</span>: item.find(<span class="string">'.shop'</span>).text(),</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># print(product)</span></span><br><span class="line">        save_to_mongo(product)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_to_mongo</span><span class="params">(result)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> db[MONGO_TABLE].insert(result):</span><br><span class="line">            print(<span class="string">'存储成功'</span>,result)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        print(<span class="string">'存储失败'</span>,result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    total = search()</span><br><span class="line">    total = int(re.compile((<span class="string">'(\d+)'</span>)).search(total).group(<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>,total + <span class="number">1</span>):</span><br><span class="line">        next_page(i)</span><br><span class="line">    browser.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<h2 id="八、验证码识别"><a href="#八、验证码识别" class="headerlink" title="八、验证码识别"></a>八、验证码识别</h2><h3 id="8-1-图形验证码的识别"><a href="#8-1-图形验证码的识别" class="headerlink" title="8.1 图形验证码的识别"></a>8.1 图形验证码的识别</h3><h2 id="九、代理的使用"><a href="#九、代理的使用" class="headerlink" title="九、代理的使用"></a>九、代理的使用</h2><h2 id="十、模拟登陆"><a href="#十、模拟登陆" class="headerlink" title="十、模拟登陆"></a>十、模拟登陆</h2><h2 id="十一、APP的爬取"><a href="#十一、APP的爬取" class="headerlink" title="十一、APP的爬取"></a>十一、APP的爬取</h2><h2 id="十二、-pyspider框架的使用"><a href="#十二、-pyspider框架的使用" class="headerlink" title="十二、 pyspider框架的使用"></a>十二、 pyspider框架的使用</h2><ul>
<li>相关链接<ul>
<li>GItHub地址：<a href="https://github.com/binux/pyspider" target="_blank" rel="noopener">https://github.com/binux/pyspider</a></li>
<li>官方文档：<a href="http://docs.pyspider.org/en/latest/" target="_blank" rel="noopener">http://docs.pyspider.org/en/latest/</a></li>
</ul>
</li>
<li>基本功能<ul>
<li>提供方便易用的WebUI系统，可视化编写和调试爬虫</li>
<li>提供爬取进度监控、爬取结果查看、爬虫项目管理等功能</li>
<li>支持多种后端数据库，如MySQL、MongoDB、Redis、SQLite、Elasticsearch、PostgreSQL</li>
<li>支持多种消息队列，如RabbitMQ、Beanstalk、Redis、Kombu</li>
<li>提供优先级控制、失败重试、定时抓取等功能</li>
<li>对接了PhantomJS，可以爬取JavaScript渲染的页面</li>
<li>支持单机和分布式部署，支持Docker部署</li>
</ul>
</li>
<li>与Scrapy比较</li>
<li>架构</li>
<li>基本使用<ul>
<li>目标：爬去去哪儿网的旅游攻略，链接为<a href="http://travel.qunar.com/travelbook/list.htm" target="_blank" rel="noopener">http://travel.qunar.com/travelbook/list.htm</a></li>
</ul>
</li>
</ul>
<h2 id="十三、Scrapy框架的使用"><a href="#十三、Scrapy框架的使用" class="headerlink" title="十三、Scrapy框架的使用"></a>十三、Scrapy框架的使用</h2><h2 id="十四、分布式爬虫"><a href="#十四、分布式爬虫" class="headerlink" title="十四、分布式爬虫"></a>十四、分布式爬虫</h2><h2 id="十五、分布式爬虫的部署"><a href="#十五、分布式爬虫的部署" class="headerlink" title="十五、分布式爬虫的部署"></a>十五、分布式爬虫的部署</h2><blockquote>
<p>待更新2018.09.11</p>
</blockquote>

      
    </div>

    

    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>entercoder1993</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://entercoder.com/2018/09/11/Python网络爬虫开发实战/" title="Python网络爬虫开发实战">http://entercoder.com/2018/09/11/Python网络爬虫开发实战/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python/" rel="tag"># Python</a>
          
            <a href="/tags/Spider/" rel="tag"># Spider</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/09/11/Python文件处理/" rel="next" title="Python文件处理">
                <i class="fa fa-chevron-left"></i> Python文件处理
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/12/CentOS7配置静态IP地址/" rel="prev" title="CentOS7配置静态IP地址">
                CentOS7配置静态IP地址 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="entercoder1993" />
            
              <p class="site-author-name" itemprop="name">entercoder1993</p>
              <p class="site-description motion-element" itemprop="description">just coding</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">33</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/entercoder1993" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Python网络爬虫开发实战"><span class="nav-number">1.</span> <span class="nav-text">Python网络爬虫开发实战</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、开发环境配置"><span class="nav-number">1.1.</span> <span class="nav-text">一、开发环境配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-Python3"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1 Python3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-请求库的安装"><span class="nav-number">1.1.2.</span> <span class="nav-text">1.2 请求库的安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Request的安装"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">Request的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Selenium的安装"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">Selenium的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ChromeDriver的安装"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">ChromeDriver的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GeckoDriver的安装"><span class="nav-number">1.1.2.4.</span> <span class="nav-text">GeckoDriver的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PhantomJS的安装"><span class="nav-number">1.1.2.5.</span> <span class="nav-text">PhantomJS的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#aiohttp的安装"><span class="nav-number">1.1.2.6.</span> <span class="nav-text">aiohttp的安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-解析库的安装"><span class="nav-number">1.1.3.</span> <span class="nav-text">1.3 解析库的安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#lxml的安装"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">lxml的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Beautiful-Soup4的安装"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">Beautiful Soup4的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pyquery的安装"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">pyquery的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#tesserocr的安装"><span class="nav-number">1.1.3.4.</span> <span class="nav-text">tesserocr的安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-数据库的安装"><span class="nav-number">1.1.4.</span> <span class="nav-text">1.4 数据库的安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL的安装"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">MySQL的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MongoDB的安装"><span class="nav-number">1.1.4.2.</span> <span class="nav-text">MongoDB的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Redis的安装"><span class="nav-number">1.1.4.3.</span> <span class="nav-text">Redis的安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-存储库的安装"><span class="nav-number">1.1.5.</span> <span class="nav-text">1.5 存储库的安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PyMySQL的安装"><span class="nav-number">1.1.5.1.</span> <span class="nav-text">PyMySQL的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PyMongo的安装"><span class="nav-number">1.1.5.2.</span> <span class="nav-text">PyMongo的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#redis-py的安装"><span class="nav-number">1.1.5.3.</span> <span class="nav-text">redis-py的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RedisDump的安装"><span class="nav-number">1.1.5.4.</span> <span class="nav-text">RedisDump的安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-6-Web库的安装"><span class="nav-number">1.1.6.</span> <span class="nav-text">1.6 Web库的安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Flask的安装"><span class="nav-number">1.1.6.1.</span> <span class="nav-text">Flask的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Tornado的安装"><span class="nav-number">1.1.6.2.</span> <span class="nav-text">Tornado的安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-7-App爬取相关的库安装"><span class="nav-number">1.1.7.</span> <span class="nav-text">1.7 App爬取相关的库安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Charles的安装"><span class="nav-number">1.1.7.1.</span> <span class="nav-text">Charles的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mitmproxy的安装"><span class="nav-number">1.1.7.2.</span> <span class="nav-text">mitmproxy的安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-8-爬虫框架的安装"><span class="nav-number">1.1.8.</span> <span class="nav-text">1.8 爬虫框架的安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#pyspider的安装"><span class="nav-number">1.1.8.1.</span> <span class="nav-text">pyspider的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Scrapy的安装"><span class="nav-number">1.1.8.2.</span> <span class="nav-text">Scrapy的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Scrapy-Splash的安装"><span class="nav-number">1.1.8.3.</span> <span class="nav-text">Scrapy-Splash的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Scrapy-Redis的安装"><span class="nav-number">1.1.8.4.</span> <span class="nav-text">Scrapy-Redis的安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-9-部署库相关的库的安装"><span class="nav-number">1.1.9.</span> <span class="nav-text">1.9 部署库相关的库的安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Docker的安装"><span class="nav-number">1.1.9.1.</span> <span class="nav-text">Docker的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Scrapyd的安装"><span class="nav-number">1.1.9.2.</span> <span class="nav-text">Scrapyd的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Scrapyd的安装-1"><span class="nav-number">1.1.9.3.</span> <span class="nav-text">Scrapyd的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Scrapyd-Client的安装"><span class="nav-number">1.1.9.4.</span> <span class="nav-text">Scrapyd-Client的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Scrapyd-API的安装"><span class="nav-number">1.1.9.5.</span> <span class="nav-text">Scrapyd API的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Scrapyrt的安装"><span class="nav-number">1.1.9.6.</span> <span class="nav-text">Scrapyrt的安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Gerapy的安装"><span class="nav-number">1.1.9.7.</span> <span class="nav-text">Gerapy的安装</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、爬虫基础"><span class="nav-number">1.2.</span> <span class="nav-text">二、爬虫基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-HTTP基本原理"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1 HTTP基本原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-网页基础"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2 网页基础</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-爬虫的基本原理"><span class="nav-number">1.2.3.</span> <span class="nav-text">2.3 爬虫的基本原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-会话和Cookies"><span class="nav-number">1.2.4.</span> <span class="nav-text">2.4 会话和Cookies</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#无状态HTTP"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">无状态HTTP</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-代理的基本原理"><span class="nav-number">1.2.5.</span> <span class="nav-text">2.5 代理的基本原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基本原理"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">基本原理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、基本库的使用"><span class="nav-number">1.3.</span> <span class="nav-text">三、基本库的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-使用urllib"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.1 使用urllib</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-使用requests"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.2 使用requests</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-正则表达式"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.3 正则表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-抓取猫眼电影排行"><span class="nav-number">1.3.4.</span> <span class="nav-text">3.4 抓取猫眼电影排行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习：抓取豆瓣top250电影排行"><span class="nav-number">1.3.5.</span> <span class="nav-text">练习：抓取豆瓣top250电影排行</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、解析库的使用"><span class="nav-number">1.4.</span> <span class="nav-text">四、解析库的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-使用XPath"><span class="nav-number">1.4.1.</span> <span class="nav-text">4.1 使用XPath</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-使用BeautifulSoup"><span class="nav-number">1.4.2.</span> <span class="nav-text">4.2 使用BeautifulSoup</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-使用pyquery"><span class="nav-number">1.4.3.</span> <span class="nav-text">4.3 使用pyquery</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五、数据存储"><span class="nav-number">1.5.</span> <span class="nav-text">五、数据存储</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-文件存储"><span class="nav-number">1.5.1.</span> <span class="nav-text">5.1 文件存储</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TXT存储"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">TXT存储</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSON文件存储"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">JSON文件存储</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CSV文件存储"><span class="nav-number">1.5.1.3.</span> <span class="nav-text">CSV文件存储</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-关系型数据库存储"><span class="nav-number">1.5.2.</span> <span class="nav-text">5.2 关系型数据库存储</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL存储"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">MySQL存储</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#非关系型存储"><span class="nav-number">1.5.3.</span> <span class="nav-text">非关系型存储</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MongoDB存储"><span class="nav-number">1.5.3.1.</span> <span class="nav-text">MongoDB存储</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Redis存储"><span class="nav-number">1.5.3.2.</span> <span class="nav-text">Redis存储</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#六、Ajax数据爬取"><span class="nav-number">1.6.</span> <span class="nav-text">六、Ajax数据爬取</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-什么是Ajax"><span class="nav-number">1.6.1.</span> <span class="nav-text">6.1 什么是Ajax</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是Ajax"><span class="nav-number">1.6.2.</span> <span class="nav-text">什么是Ajax</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基本原理-1"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">基本原理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-Ajax分析方法"><span class="nav-number">1.6.3.</span> <span class="nav-text">6.2 Ajax分析方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-Ajax结果提取"><span class="nav-number">1.6.4.</span> <span class="nav-text">6.3 Ajax结果提取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-分析Ajax爬取今日头条街拍美图"><span class="nav-number">1.6.5.</span> <span class="nav-text">6.4 分析Ajax爬取今日头条街拍美图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ajax分析方法"><span class="nav-number">1.6.6.</span> <span class="nav-text">Ajax分析方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#七、动态渲染页面爬取"><span class="nav-number">1.7.</span> <span class="nav-text">七、动态渲染页面爬取</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-Selenium的使用"><span class="nav-number">1.7.1.</span> <span class="nav-text">7.1 Selenium的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-Splash的使用"><span class="nav-number">1.7.2.</span> <span class="nav-text">7.2 Splash的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-Splash负载均衡配置"><span class="nav-number">1.7.3.</span> <span class="nav-text">7.3 Splash负载均衡配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-使用Selenium爬取淘宝商品"><span class="nav-number">1.7.4.</span> <span class="nav-text">7.4 使用Selenium爬取淘宝商品</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#八、验证码识别"><span class="nav-number">1.8.</span> <span class="nav-text">八、验证码识别</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-图形验证码的识别"><span class="nav-number">1.8.1.</span> <span class="nav-text">8.1 图形验证码的识别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#九、代理的使用"><span class="nav-number">1.9.</span> <span class="nav-text">九、代理的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十、模拟登陆"><span class="nav-number">1.10.</span> <span class="nav-text">十、模拟登陆</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十一、APP的爬取"><span class="nav-number">1.11.</span> <span class="nav-text">十一、APP的爬取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十二、-pyspider框架的使用"><span class="nav-number">1.12.</span> <span class="nav-text">十二、 pyspider框架的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十三、Scrapy框架的使用"><span class="nav-number">1.13.</span> <span class="nav-text">十三、Scrapy框架的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十四、分布式爬虫"><span class="nav-number">1.14.</span> <span class="nav-text">十四、分布式爬虫</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十五、分布式爬虫的部署"><span class="nav-number">1.15.</span> <span class="nav-text">十五、分布式爬虫的部署</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">entercoder1993</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">197k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">2:59</span>
  
</div>


  



  <div class="powered-by">由 <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" rel="external nofollow" href="https://theme-next.org">NexT.Pisces</a> v6.3.0</div>




        








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>







  






  











  





  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script id="ribbon" type="text/javascript" size="100" alpha="0.6"  zIndex="-3" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'wiKUeszt5GJCSdJeztbJXwSf-gzGzoHsz',
        appKey: 'u4P15OXMMOJRM1zlDd6aqg0z',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  

  

  

  
  
  
  <script src="/lib/bookmark/bookmark.min.js?v=1.0"></script>
  <script type="text/javascript">
  
    bookmark.scrollToMark('auto', "#更多");
  
  </script>


  

</body>
</html>
